{"version":3,"file":"main.5ce858c24b0d82512461.bundle.js","mappings":"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","sources":["webpack://tweb/webpack/runtime/chunk loaded","webpack://tweb/webpack/runtime/create fake namespace object","webpack://tweb/webpack/runtime/load script","webpack://tweb/webpack/runtime/compat","webpack://tweb/./src/config/state.ts","webpack://tweb/./src/helpers/getTimeFormat.ts","webpack://tweb/./src/environment/appleMx.ts","webpack://tweb/./src/environment/callSupport.ts","webpack://tweb/./src/environment/canUseTransferables.ts","webpack://tweb/./src/environment/canvasFilterSupport.ts","webpack://tweb/./src/environment/emojiSupport.ts","webpack://tweb/./src/environment/geolocationSupport.ts","webpack://tweb/./src/environment/groupCallSupport.ts","webpack://tweb/./src/environment/imageMimeTypesSupport.ts","webpack://tweb/./src/environment/mediaMimeTypesSupport.ts","webpack://tweb/./src/environment/movSupport.ts","webpack://tweb/./src/environment/opusSupport.ts","webpack://tweb/./src/environment/parallaxSupport.ts","webpack://tweb/./src/environment/screenSharingSupport.ts","webpack://tweb/./src/environment/sharedWorkerSupport.ts","webpack://tweb/./src/environment/touchSupport.ts","webpack://tweb/./src/environment/userAgent.ts","webpack://tweb/./src/environment/vibrateSupport.ts","webpack://tweb/./src/environment/videoMimeTypesSupport.ts","webpack://tweb/./src/environment/webpSupport.ts","webpack://tweb/./src/environment/webrtcSupport.ts","webpack://tweb/./src/helpers/color.ts","webpack://tweb/./src/helpers/compareVersion.ts","webpack://tweb/./src/helpers/dom/blurActiveElement.ts","webpack://tweb/./src/helpers/dom/cancelEvent.ts","webpack://tweb/./src/helpers/dom/findUpClassName.ts","webpack://tweb/./src/helpers/dom/fixSafariStickyInput.ts","webpack://tweb/./src/helpers/dom/fixSafariStickyInputFocusing.ts","webpack://tweb/./src/helpers/dom/loadFonts.ts","webpack://tweb/./src/helpers/idleController.ts","webpack://tweb/./src/helpers/overlayCounter.ts","webpack://tweb/./src/helpers/schedulers.ts","webpack://tweb/./src/helpers/themeController.ts","webpack://tweb/./src/helpers/setWorkerProxy.ts","webpack://tweb/./src/index.ts","webpack://tweb/./src/helpers/dom/toggleAttributePolyfill.ts","webpack://tweb/./src/lib/appManagers/appRuntimeManager.ts","webpack://tweb/./src/lib/appManagers/getProxiedManagers.ts","webpack://tweb/./src/lib/idb.ts","webpack://tweb/./src/lib/langPack.ts","webpack://tweb/./src/lib/mtproto/mtproto_config.ts","webpack://tweb/./src/environment/webmSupport.ts","webpack://tweb/./src/environment/index.ts","webpack://tweb/./src/lib/appManagers/utils/state/loadState.ts","webpack://tweb/./src/lib/mtproto/mtprotoworker.ts","webpack://tweb/./src/lib/mtproto/singleInstance.ts","webpack://tweb/./src/lib/mtproto/telegramMeWebManager.ts","webpack://tweb/./src/lib/mtproto/webPushApiManager.ts","webpack://tweb/./src/lib/opusDecodeController.ts","webpack://tweb/./src/lib/richTextProcessor/index.ts","webpack://tweb/./src/lib/rootScope.ts","webpack://tweb/./src/lib/webp/webpWorkerController.ts","webpack://tweb/webpack/bootstrap","webpack://tweb/webpack/runtime/compat get default export","webpack://tweb/webpack/runtime/define property getters","webpack://tweb/webpack/runtime/ensure chunk","webpack://tweb/webpack/runtime/get javascript chunk filename","webpack://tweb/webpack/runtime/get mini-css chunk filename","webpack://tweb/webpack/runtime/global","webpack://tweb/webpack/runtime/hasOwnProperty shorthand","webpack://tweb/webpack/runtime/make namespace object","webpack://tweb/webpack/runtime/publicPath","webpack://tweb/webpack/runtime/jsonp chunk loading","webpack://tweb/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var inProgress = {};\nvar dataWebpackPrefix = \"tweb:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\t;\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","(() => {\n  if (typeof __webpack_require__ !== 'undefined') {\n    var oldGetScript = __webpack_require__.u;\n    var oldLoadScript = __webpack_require__.e;\n    var queryMap = {};\n    var countMap = {};\n    var getRetryDelay = function () {\n      return 3000;\n    };\n    __webpack_require__.u = function (chunkId) {\n      var result = oldGetScript(chunkId);\n      return (\n        result +\n        (queryMap.hasOwnProperty(chunkId) ? '?' + queryMap[chunkId] : '')\n      );\n    };\n    __webpack_require__.e = function (chunkId) {\n      var result = oldLoadScript(chunkId);\n      return result.catch(function (error) {\n        var retries = countMap.hasOwnProperty(chunkId)\n          ? countMap[chunkId]\n          : 999999;\n        if (retries < 1) {\n          var realSrc = oldGetScript(chunkId);\n          error.message =\n            'Loading chunk ' +\n            chunkId +\n            ' failed after 999999 retries.\\n(' +\n            realSrc +\n            ')';\n          error.request = realSrc;\n          throw error;\n        }\n        return new Promise(function (resolve) {\n          var retryAttempt = 999999 - retries + 1;\n          setTimeout(function () {\n            var retryAttemptString = '&retry-attempt=' + retryAttempt;\n            var cacheBust = (function () {\n              return Date.now();\n            })();\n            +retryAttemptString;\n            queryMap[chunkId] = cacheBust;\n            countMap[chunkId] = retries - 1;\n            resolve(__webpack_require__.e(chunkId));\n          }, getRetryDelay(retryAttempt));\n        });\n      });\n    };\n  }\n})();\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { AppMediaPlaybackController } from \"../components/appMediaPlaybackController\";\r\nimport { IS_MOBILE } from \"../environment/userAgent\";\r\nimport getTimeFormat from \"../helpers/getTimeFormat\";\r\nimport { nextRandomUint } from \"../helpers/random\";\r\nimport { AutoDownloadSettings, NotifyPeer, PeerNotifySettings } from \"../layer\";\r\nimport { TopPeerType, MyTopPeer } from \"../lib/appManagers/appUsersManager\";\r\nimport DialogsStorage from \"../lib/storages/dialogs\";\r\nimport FiltersStorage from \"../lib/storages/filters\";\r\nimport { AuthState } from \"../types\";\r\nimport App from \"./app\";\r\n\r\nconst STATE_VERSION = App.version;\r\nconst BUILD = App.build;\r\n\r\nexport type Background = {\r\n  type?: 'color' | 'image' | 'default', // ! DEPRECATED\r\n  blur: boolean,\r\n  highlightningColor?: string,\r\n  color?: string,     \r\n  slug?: string,        // image slug\r\n  intensity?: number,   // pattern intensity\r\n  id: string | number,  // wallpaper id\r\n};\r\n\r\nexport type Theme = {\r\n  name: 'day' | 'night' | 'system',\r\n  background: Background\r\n};\r\n\r\nexport type AutoDownloadPeerTypeSettings = {\r\n  contacts: boolean,\r\n  private: boolean,\r\n  groups: boolean,\r\n  channels: boolean\r\n};\r\n\r\nexport type State = {\r\n  allDialogsLoaded: DialogsStorage['allDialogsLoaded'],\r\n  pinnedOrders: DialogsStorage['pinnedOrders'],\r\n  // contactsList: UserId[],\r\n  contactsListCachedTime: number,\r\n  updates: Partial<{\r\n    seq: number,\r\n    pts: number,\r\n    date: number\r\n  }>,\r\n  filters: FiltersStorage['filters'],\r\n  maxSeenMsgId: number,\r\n  stateCreatedTime: number,\r\n  recentEmoji: string[],\r\n  topPeersCache: {\r\n    [type in TopPeerType]?: {\r\n      peers: MyTopPeer[],\r\n      cachedTime: number\r\n    }\r\n  },\r\n  recentSearch: PeerId[],\r\n  version: typeof STATE_VERSION,\r\n  build: typeof BUILD,\r\n  authState: AuthState,\r\n  hiddenPinnedMessages: {[peerId: PeerId]: number},\r\n  settings: {\r\n    messagesTextSize: number,\r\n    distanceUnit: 'kilometers' | 'miles',\r\n    sendShortcut: 'enter' | 'ctrlEnter',\r\n    animationsEnabled: boolean,\r\n    autoDownload: {\r\n      contacts?: boolean, // ! DEPRECATED\r\n      private?: boolean, // ! DEPRECATED\r\n      groups?: boolean, // ! DEPRECATED\r\n      channels?: boolean, // ! DEPRECATED\r\n      photo: AutoDownloadPeerTypeSettings,\r\n      video: AutoDownloadPeerTypeSettings,\r\n      file: AutoDownloadPeerTypeSettings\r\n    },\r\n    autoDownloadNew: AutoDownloadSettings,\r\n    autoPlay: {\r\n      gifs: boolean,\r\n      videos: boolean\r\n    },\r\n    stickers: {\r\n      suggest: boolean,\r\n      loop: boolean\r\n    },\r\n    emoji: {\r\n      suggest: boolean,\r\n      big: boolean\r\n    },\r\n    background?: Background, // ! DEPRECATED\r\n    themes: Theme[],\r\n    theme: Theme['name'],\r\n    notifications: {\r\n      sound: boolean\r\n    },\r\n    nightTheme?: boolean, // ! DEPRECATED\r\n    timeFormat: 'h12' | 'h23'\r\n  },\r\n  playbackParams: ReturnType<AppMediaPlaybackController['getPlaybackParams']>,\r\n  keepSigned: boolean,\r\n  chatContextMenuHintWasShown: boolean,\r\n  stateId: number,\r\n  notifySettings: {[k in Exclude<NotifyPeer['_'], 'notifyPeer'>]?: PeerNotifySettings.peerNotifySettings}\r\n};\r\n\r\nconst BACKGROUND_DAY_DESKTOP: Background = {\r\n  blur: false,\r\n  slug: 'pattern',\r\n  color: '#dbddbb,#6ba587,#d5d88d,#88b884',\r\n  highlightningColor: 'hsla(86.4, 43.846153%, 45.117647%, .4)',\r\n  intensity: 50,\r\n  id: '1'\r\n};\r\n\r\nconst BACKGROUND_DAY_MOBILE: Background = {\r\n  blur: false,\r\n  slug: '',\r\n  color: '#dbddbb,#6ba587,#d5d88d,#88b884',\r\n  highlightningColor: 'hsla(86.4, 43.846153%, 45.117647%, .4)',\r\n  intensity: 0,\r\n  id: '1'\r\n};\r\n\r\nconst BACKGROUND_NIGHT_DESKTOP: Background = {\r\n  blur: false,\r\n  slug: 'pattern',\r\n  // color: '#dbddbb,#6ba587,#d5d88d,#88b884',\r\n  color: '#fec496,#dd6cb9,#962fbf,#4f5bd5',\r\n  highlightningColor: 'hsla(299.142857, 44.166666%, 37.470588%, .4)',\r\n  intensity: -50,\r\n  id: '-1'\r\n};\r\n\r\nconst BACKGROUND_NIGHT_MOBILE: Background = {\r\n  blur: false,\r\n  slug: '',\r\n  color: '#0f0f0f',\r\n  highlightningColor: 'hsla(0, 0%, 3.82353%, 0.4)',\r\n  intensity: 0,\r\n  id: '-1'\r\n};\r\n\r\nexport const STATE_INIT: State = {\r\n  allDialogsLoaded: {},\r\n  pinnedOrders: {},\r\n  // contactsList: [],\r\n  contactsListCachedTime: 0,\r\n  updates: {},\r\n  filters: {},\r\n  maxSeenMsgId: 0,\r\n  stateCreatedTime: Date.now(),\r\n  recentEmoji: [],\r\n  topPeersCache: {},\r\n  recentSearch: [],\r\n  version: STATE_VERSION,\r\n  build: BUILD,\r\n  authState: {\r\n    _: IS_MOBILE ? 'authStateSignIn' : 'authStateSignQr'\r\n  },\r\n  hiddenPinnedMessages: {},\r\n  settings: {\r\n    messagesTextSize: 16,\r\n    distanceUnit: 'kilometers',\r\n    sendShortcut: 'enter',\r\n    animationsEnabled: true,\r\n    autoDownload: {\r\n      photo: {\r\n        contacts: true,\r\n        private: true,\r\n        groups: true,\r\n        channels: true\r\n      },\r\n      video: {\r\n        contacts: true,\r\n        private: true,\r\n        groups: true,\r\n        channels: true\r\n      },\r\n      file: {\r\n        contacts: true,\r\n        private: true,\r\n        groups: true,\r\n        channels: true\r\n      }\r\n    },\r\n    autoDownloadNew: {\r\n      _: 'autoDownloadSettings',\r\n      file_size_max: 3145728,\r\n      pFlags: {\r\n        video_preload_large: true,\r\n        audio_preload_next: true\r\n      },\r\n      photo_size_max: 1048576,\r\n      video_size_max: 15728640,\r\n      video_upload_maxbitrate: 100\r\n    },\r\n    autoPlay: {\r\n      gifs: true,\r\n      videos: true\r\n    },\r\n    stickers: {\r\n      suggest: true,\r\n      loop: true\r\n    },\r\n    emoji: {\r\n      suggest: true,\r\n      big: true\r\n    },\r\n    themes: [{\r\n      name: 'day',\r\n      background: IS_MOBILE ? BACKGROUND_DAY_MOBILE : BACKGROUND_DAY_DESKTOP\r\n    }, {\r\n      name: 'night',\r\n      background: IS_MOBILE ? BACKGROUND_NIGHT_MOBILE : BACKGROUND_NIGHT_DESKTOP\r\n    }],\r\n    theme: 'system',\r\n    notifications: {\r\n      sound: false\r\n    },\r\n    timeFormat: getTimeFormat()\r\n  },\r\n  playbackParams: {\r\n    volume: 1,\r\n    muted: false,\r\n    playbackRate: 1,\r\n    playbackRates: {\r\n      voice: 1,\r\n      video: 1,\r\n      audio: 1\r\n    },\r\n    loop: false,\r\n    round: false\r\n  },\r\n  keepSigned: true,\r\n  chatContextMenuHintWasShown: false,\r\n  stateId: nextRandomUint(32),\r\n  notifySettings: {}\r\n};\r\n","export default function getTimeFormat(): 'h12' | 'h23' {\r\n  // try {\r\n  //   const resolvedOptions = Intl.DateTimeFormat(navigator.language,  {hour: 'numeric'}).resolvedOptions();\r\n  //   if('hourCycle' in resolvedOptions) {\r\n  //     return (resolvedOptions as any).hourCycle === 'h12' ? 'h12' : 'h23';\r\n  //   } else {\r\n  //     return resolvedOptions.hour12 ? 'h12' : 'h23';\r\n  //   }\r\n  // } catch(err) {\r\n    return new Date().toLocaleString().match(/\\s(AM|PM)/) ? 'h12' : 'h23';\r\n  // }\r\n}\r\n","let IS_APPLE_MX = false;\r\n\r\ntry {\r\n  // Awesome detect from https://stackoverflow.com/a/65412357\r\n  const ctx = document.createElement('canvas').getContext('webgl');\r\n  const extension = ctx.getExtension('WEBGL_debug_renderer_info');\r\n  const renderer: string = extension && ctx.getParameter(extension.UNMASKED_RENDERER_WEBGL) || '';\r\n  if((renderer.match(/Apple/) && !renderer.match(/Apple GPU/)) || \r\n    ctx.getSupportedExtensions().indexOf(\"WEBGL_compressed_texture_s3tc_srgb\") === -1) {\r\n    IS_APPLE_MX = true;\r\n  }\r\n} catch(err) {\r\n\r\n}\r\n\r\nexport default IS_APPLE_MX;\r\n","import IS_WEBRTC_SUPPORTED from \"./webrtcSupport\";\r\n\r\nconst IS_CALL_SUPPORTED = IS_WEBRTC_SUPPORTED;\r\n\r\nexport default IS_CALL_SUPPORTED;\r\n","import { IS_SAFARI } from \"./userAgent\";\r\n\r\n/*\r\n * This is used as a workaround for a memory leak in Safari caused by using Transferable objects to\r\n * transfer data between WebWorkers and the main thread.\r\n * https://github.com/mapbox/mapbox-gl-js/issues/8771\r\n *\r\n * This should be removed once the underlying Safari issue is fixed.\r\n */\r\n\r\nlet CAN_USE_TRANSFERABLES: boolean;\r\nif(!IS_SAFARI) CAN_USE_TRANSFERABLES = true;\r\nelse {\r\n  try {\r\n    const match = navigator.userAgent.match(/Version\\/(.+?) /);\r\n    CAN_USE_TRANSFERABLES = +match[1] >= 14;\r\n  } catch(err) {\r\n    CAN_USE_TRANSFERABLES = false;\r\n  }\r\n}\r\n\r\nexport default CAN_USE_TRANSFERABLES;\r\n","const IS_CANVAS_FILTER_SUPPORTED = 'filter' in (document.createElement('canvas').getContext('2d') || {});\r\n\r\nexport default IS_CANVAS_FILTER_SUPPORTED;","const IS_EMOJI_SUPPORTED = navigator.userAgent.search(/OS X|iPhone|iPad|iOS/i) !== -1/*  && false *//*  || true */;\r\n\r\nexport default IS_EMOJI_SUPPORTED;\r\n","const IS_GEOLOCATION_SUPPORTED = !!navigator?.geolocation?.getCurrentPosition && false;\r\n\r\nexport default IS_GEOLOCATION_SUPPORTED;\r\n","import IS_WEBRTC_SUPPORTED from \"./webrtcSupport\";\r\n\r\nconst IS_GROUP_CALL_SUPPORTED = IS_WEBRTC_SUPPORTED;\r\n\r\nexport default IS_GROUP_CALL_SUPPORTED;\r\n","import IS_WEBP_SUPPORTED from \"./webpSupport\";\r\n\r\nconst IMAGE_MIME_TYPES_SUPPORTED = new Set([\r\n  'image/jpeg',\r\n  'image/png',\r\n  'image/bmp'\r\n]);\r\n\r\nif(IS_WEBP_SUPPORTED) {\r\n  IMAGE_MIME_TYPES_SUPPORTED.add('image/webp');\r\n}\r\n\r\nexport default IMAGE_MIME_TYPES_SUPPORTED;\r\n","import IMAGE_MIME_TYPES_SUPPORTED from \"./imageMimeTypesSupport\";\r\nimport VIDEO_MIME_TYPES_SUPPORTED from \"./videoMimeTypesSupport\";\r\n\r\nconst arr = [...IMAGE_MIME_TYPES_SUPPORTED].concat([...VIDEO_MIME_TYPES_SUPPORTED]);\r\n\r\nconst MEDIA_MIME_TYPES_SUPPORTED = new Set(arr);\r\n\r\nexport default MEDIA_MIME_TYPES_SUPPORTED;\r\n","import { IS_APPLE_MOBILE, IS_SAFARI } from \"./userAgent\";\r\n\r\n// mov is not supported in Chrome on macOS\r\nconst IS_MOV_SUPPORTED = !!document.createElement('video').canPlayType('video/quicktime') || IS_SAFARI || IS_APPLE_MOBILE;\r\n\r\nexport default IS_MOV_SUPPORTED;\r\n","const audio = document.createElement('audio');\r\nconst IS_OPUS_SUPPORTED = !!(audio.canPlayType && audio.canPlayType('audio/ogg;').replace(/no/, ''))/*  && false */;\r\n\r\nexport default IS_OPUS_SUPPORTED;\r\n","import { IS_FIREFOX } from \"./userAgent\";\r\n\r\nconst IS_PARALLAX_SUPPORTED = !IS_FIREFOX && false;\r\n\r\nexport default IS_PARALLAX_SUPPORTED;\r\n","const IS_SCREEN_SHARING_SUPPORTED = !!('getDisplayMedia' in (navigator?.mediaDevices || {}));\r\n\r\nexport default IS_SCREEN_SHARING_SUPPORTED;\r\n","const IS_SHARED_WORKER_SUPPORTED = typeof(SharedWorker) !== 'undefined'/*  && false */;\r\n\r\nexport default IS_SHARED_WORKER_SUPPORTED;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// @ts-ignore\r\nconst IS_TOUCH_SUPPORTED = ('ontouchstart' in window) || (window.DocumentTouch && document instanceof DocumentTouch)/*  || true */;\r\nexport default IS_TOUCH_SUPPORTED;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ctx from './ctx';\r\n\r\nexport const USER_AGENT = navigator ? navigator.userAgent : null;\r\nexport const IS_APPLE = navigator.userAgent.search(/OS X|iPhone|iPad|iOS/i) !== -1;\r\nexport const IS_ANDROID = navigator.userAgent.toLowerCase().indexOf('android') !== -1;\r\nexport const IS_CHROMIUM = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);\r\n\r\n// https://stackoverflow.com/a/58065241\r\nexport const IS_APPLE_MOBILE = (/iPad|iPhone|iPod/.test(navigator.platform) ||\r\n  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&\r\n  !(ctx as any).MSStream;\r\n\r\nexport const IS_SAFARI = !!('safari' in ctx) || !!(USER_AGENT && (/\\b(iPad|iPhone|iPod)\\b/.test(USER_AGENT) || (!!USER_AGENT.match('Safari') && !USER_AGENT.match('Chrome'))))/*  || true */;\r\nexport const IS_FIREFOX = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const IS_MOBILE_SAFARI = IS_SAFARI && IS_APPLE_MOBILE;\r\n\r\nexport const IS_MOBILE = /* screen.width && screen.width < 480 ||  */navigator.maxTouchPoints > 0 && navigator.userAgent.search(/iOS|iPhone OS|Android|BlackBerry|BB10|Series ?[64]0|J2ME|MIDP|opera mini|opera mobi|mobi.+Gecko|Windows Phone/i) != -1;\r\n","const IS_VIBRATE_SUPPORTED = !!navigator?.vibrate;\r\n\r\nexport default IS_VIBRATE_SUPPORTED;\r\n","import IS_MOV_SUPPORTED from \"./movSupport\";\r\n\r\nconst VIDEO_MIME_TYPES_SUPPORTED = new Set([\r\n  'image/gif', // have to display it as video\r\n  'video/mp4',\r\n  'video/webm'\r\n]);\r\n\r\nif(IS_MOV_SUPPORTED) {\r\n  VIDEO_MIME_TYPES_SUPPORTED.add('video/quicktime');\r\n}\r\n\r\nexport default VIDEO_MIME_TYPES_SUPPORTED;\r\n","const IS_WEBP_SUPPORTED = document.createElement('canvas').toDataURL('image/webp').startsWith('data:image/webp');\r\n\r\nexport default IS_WEBP_SUPPORTED;\r\n","import { IS_FIREFOX } from \"./userAgent\";\r\n\r\nconst IS_WEBRTC_SUPPORTED = !!(typeof(RTCPeerConnection) !== 'undefined' && !IS_FIREFOX);\r\n\r\nexport default IS_WEBRTC_SUPPORTED;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type ColorHsla = {\r\n  h: number,\r\n  s: number,\r\n  l: number,\r\n  a: number\r\n};\r\n\r\nexport type ColorRgba = [number, number, number, number];\r\nexport type ColorRgb = [number, number, number];\r\n\r\n/**\r\n * @returns h [0, 360], s [0, 100], l [0, 100], a [0, 1]\r\n */\r\nexport function rgbaToHsla(r: number, g: number, b: number, a: number = 1): ColorHsla {\r\n  r /= 255, g /= 255, b /= 255;\r\n  const max = Math.max(r, g, b),\r\n        min = Math.min(r, g, b);\r\n  let h, s, l = (max + min) / 2;\r\n\r\n  if(max === min) {\r\n    h = s = 0; // achromatic\r\n  } else {\r\n    let d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n    switch (max) {\r\n      case r:\r\n        h = (g - b) / d + (g < b ? 6 : 0);\r\n        break;\r\n      case g:\r\n        h = (b - r) / d + 2;\r\n        break;\r\n      case b:\r\n        h = (r - g) / d + 4;\r\n        break;\r\n    }\r\n    h /= 6;\r\n  }\r\n\r\n  return {\r\n    h: h * 360,\r\n    s: s * 100,\r\n    l: l * 100,\r\n    a\r\n  };\r\n}\r\n\r\n// * https://stackoverflow.com/a/9493060/6758968\r\n/**\r\n * Converts an HSL color value to RGB. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n * Assumes h in [0, 360], s, and l are contained in the set [0, 1], a in [0, 1] and\r\n * returns r, g, and b in the set [0, 255].\r\n *\r\n * @param   {number}  h       The hue\r\n * @param   {number}  s       The saturation\r\n * @param   {number}  l       The lightness\r\n * @return  {Array}           The RGB representation\r\n */\r\nexport function hslaToRgba(h: number, s: number, l: number, a: number): ColorRgba {\r\n  h /= 360, s /= 100, l /= 100;\r\n  let r: number, g: number, b: number;\r\n\r\n  if(s === 0) {\r\n    r = g = b = l; // achromatic\r\n  } else {\r\n    const hue2rgb = function hue2rgb(p: number, q: number, t: number) {\r\n      if(t < 0) t += 1;\r\n      if(t > 1) t -= 1;\r\n      if(t < 1/6) return p + (q - p) * 6 * t;\r\n      if(t < 1/2) return q;\r\n      if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\r\n      return p;\r\n    }\r\n\r\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n    const p = 2 * l - q;\r\n    r = hue2rgb(p, q, h + 1/3);\r\n    g = hue2rgb(p, q, h);\r\n    b = hue2rgb(p, q, h - 1/3);\r\n  }\r\n\r\n  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255), Math.round(a * 255)];\r\n}\r\n\r\nexport function hslaStringToRgba(hsla: string) {\r\n  const splitted = hsla.slice(5, -1).split(', ');\r\n  const alpha = +splitted.pop();\r\n  const arr = splitted.map((val) => {\r\n    if(val.endsWith('%')) {\r\n      return +val.slice(0, -1);\r\n    }\r\n    \r\n    return +val;\r\n  });\r\n\r\n  return hslaToRgba(arr[0], arr[1], arr[2], alpha);\r\n}\r\n\r\nexport function hexaToRgba(hexa: string) {\r\n  const arr: ColorRgba = [] as any;\r\n  const offset = hexa[0] === '#' ? 1 : 0;\r\n  if(hexa.length === (5 + offset)) {\r\n    hexa = (offset ? '#' : '') + '0' + hexa.slice(offset);\r\n  }\r\n\r\n  if(hexa.length === (3 + offset)) {\r\n    for(let i = offset; i < hexa.length; ++i) {\r\n      arr.push(parseInt(hexa[i] + hexa[i], 16));\r\n    }\r\n  } else if(hexa.length === (4 + offset)) {\r\n    for(let i = offset; i < (hexa.length - 1); ++i) {\r\n      arr.push(parseInt(hexa[i] + hexa[i], 16));\r\n    }\r\n\r\n    arr.push(parseInt(hexa[hexa.length - 1], 16));\r\n  } else {\r\n    for(let i = offset; i < hexa.length; i += 2) {\r\n      arr.push(parseInt(hexa.slice(i, i + 2), 16));\r\n    }\r\n  }\r\n\r\n  return arr;\r\n}\r\n\r\nexport function hexToRgb(hex: string) {\r\n  return hexaToRgba(hex.slice(0, 7)) as any as ColorRgb;\r\n}\r\n\r\nexport function hexaToHsla(hexa: string) {\r\n  const rgba = hexaToRgba(hexa);\r\n  return rgbaToHsla(rgba[0], rgba[1], rgba[2], rgba[3]);\r\n}\r\n\r\nexport function rgbaToHexa(rgba: ColorRgba | ColorRgb) {\r\n  return '#' + rgba.map((v) => ('0' + v.toString(16)).slice(-2)).join('');\r\n}\r\n\r\nexport function hslaStringToHexa(hsla: string) {\r\n  return rgbaToHexa(hslaStringToRgba(hsla));\r\n}\r\n\r\nexport function hslaStringToHex(hsla: string) {\r\n  return hslaStringToHexa(hsla).slice(0, -2);\r\n}\r\n","export default function compareVersion(v1: string, v2: string): number {\r\n  v1 = v1.split(' ', 1)[0];\r\n  v2 = v2.split(' ', 1)[0];\r\n  const s1 = v1.split('.');\r\n  const s2 = v2.split('.');\r\n\r\n  for(let i = 0; i < s1.length; ++i) {\r\n    const v1 = +s1[i];\r\n    const v2 = +s2[i];\r\n    if(v1 > v2) return 1;\r\n    else if(v1 < v2) return -1;\r\n  }\r\n\r\n  return 0;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function blurActiveElement() {\r\n  if(document.activeElement && (document.activeElement as HTMLInputElement).blur) {\r\n    (document.activeElement as HTMLInputElement).blur();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nexport default function cancelEvent(event: Event) {\r\n  event = event || window.event;\r\n  if(event) {\r\n    // @ts-ignore\r\n    event = event.originalEvent || event;\r\n\r\n    try {\r\n      if(event.stopPropagation) event.stopPropagation();\r\n      if(event.preventDefault) event.preventDefault();\r\n      event.returnValue = false;\r\n      event.cancelBubble = true;\r\n    } catch(err) {}\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n//export function findUpClassName<T>(el: any, className: string): T;\r\nexport default function findUpClassName(el: EventTarget | {closest: (selector: string) => any}, className: string): HTMLElement {\r\n  return (el as any).closest('.' + className);\r\n  /* if(el.classList.contains(className)) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.classList.contains(className)) \r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { doubleRaf } from \"../schedulers\";\r\n\r\nexport default function fixSafariStickyInput(input: HTMLElement) {\r\n  input.style.transform = 'translateY(-99999px)';\r\n  /* input.style.position = 'fixed';\r\n  input.style.top = '-99999px';\r\n  input.style.left = '0'; */\r\n  input.focus();\r\n  \r\n  // setTimeout(() => {\r\n    doubleRaf().then(() => {\r\n    //fastSmoothScroll(findUpClassName(input, 'scrollable-y') || window as any, document.activeElement as HTMLElement, 'start', 4, undefined, FocusDirection.Static);\r\n    /* input.style.position = '';\r\n    input.style.top = ''; */\r\n    input.style.transform = '';\r\n    //fastSmoothScroll(findUpClassName(input, 'scrollable-y') || window as any, document.activeElement as HTMLElement, 'start', 4, undefined, FocusDirection.Static);\r\n    \r\n    /* setTimeout(() => {\r\n      fastSmoothScroll(findUpClassName(input, 'scrollable-y') || window as any, document.activeElement as HTMLElement, 'start', 4);\r\n    }, 50); */\r\n  });\r\n  // }, 0);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from \"../../environment/touchSupport\";\r\nimport { IS_MOBILE, IS_SAFARI } from \"../../environment/userAgent\";\r\nimport findUpClassName from \"./findUpClassName\";\r\nimport fixSafariStickyInput from \"./fixSafariStickyInput\";\r\n\r\nexport const IS_STICKY_INPUT_BUGGED = IS_SAFARI && IS_MOBILE && IS_TOUCH_SUPPORTED;\r\n\r\nif(IS_STICKY_INPUT_BUGGED) {\r\n  let key: 'clientY' | 'pageY' = 'clientY';\r\n  let startY = 0;\r\n  const o = {capture: true, passive: false};\r\n  const onTouchMove = (e: TouchEvent) => {\r\n    const touch = e.touches[0];\r\n\r\n    //console.log('touchmove y', touch[key], startY);\r\n    \r\n    const scrollable = findUpClassName(touch.target, 'scrollable-y');\r\n    if(scrollable) {\r\n      const y = touch[key];\r\n      const scrolled = startY - y;\r\n\r\n      /* if(y < startY) {\r\n        startY = y;\r\n      } */\r\n\r\n      const scrollTop = scrollable.scrollTop;\r\n      const scrollHeight = scrollable.scrollHeight;\r\n      const clientHeight = scrollable.clientHeight;\r\n      const nextScrollTop = scrollTop ? Math.round(scrollTop + scrollable.clientHeight + scrolled) : scrollTop + scrolled;\r\n      //const needCancel = scrollHeight !== clientHeight ? (scrollTop && diff <= 1) || (scrollTop - diff) < 0 : true;\r\n      const needCancel = scrollHeight === clientHeight || nextScrollTop >= scrollHeight || nextScrollTop <= 0;\r\n      if(needCancel) {\r\n        e.preventDefault();\r\n      }\r\n\r\n      //console.log('touchmove with scrollable', scrollTop, startY, scrolled, nextScrollTop, needCancel, e.cancelable);\r\n    } else {\r\n      e.preventDefault();\r\n\r\n      //console.log('touchmove no scrollable', e, touch);\r\n    }\r\n\r\n    //if(e.target === document.documentElement || e.target === document.body) e.preventDefault();\r\n  };\r\n  \r\n  // let el = document.createElement('div');\r\n  // document.body.prepend(el);\r\n  // let a = 0;\r\n\r\n  // let hasFocus = false;\r\n  let lastFocusOutTimeStamp = 0;\r\n  document.addEventListener('focusin', (e) => {\r\n    if(!(e.target as HTMLElement).classList.contains('is-sticky-input-bugged') || (e.timeStamp - lastFocusOutTimeStamp) < 50/*  && document.activeElement === input */) {\r\n      return;\r\n    }\r\n\r\n    // console.log('focusin', e, e.timeStamp);\r\n\r\n    // hasFocus = true;\r\n    // document.body.classList.add('is-keyboard-opened');\r\n\r\n    // el.innerText = 'focusin ' + ++a;\r\n\r\n    /* a < 2 &&  */fixSafariStickyInput(e.target as HTMLElement);\r\n\r\n    document.addEventListener('touchmove', onTouchMove, o);\r\n    document.addEventListener('touchstart', (e) => {\r\n      if(e.touches.length > 1) return;\r\n      const touchStart = e.touches[0];\r\n  \r\n      startY = touchStart[key];\r\n    });\r\n  }, {passive: true});\r\n\r\n  document.addEventListener('focusout', (e) => {\r\n    // console.log('focusout', e, e.timeStamp);\r\n    document.removeEventListener('touchmove', onTouchMove, o);\r\n\r\n    lastFocusOutTimeStamp = e.timeStamp;\r\n\r\n    // el.innerText = 'focusout ' + ++a;\r\n    \r\n    // if(hasFocus) {\r\n    //   hasFocus = false;\r\n    //   document.body.classList.remove('is-keyboard-opened');\r\n    // }\r\n  }, {passive: true});\r\n\r\n  document.addEventListener('visibilitychange', () => {\r\n    // console.log('window visibilitychange');\r\n    if(document.activeElement && \r\n      document.activeElement.classList.contains('is-sticky-input-bugged') && \r\n      (document.activeElement as HTMLElement).blur) {\r\n      fixSafariStickyInput(document.activeElement as HTMLElement);\r\n    }\r\n\r\n    /* blurActiveElement();\r\n    window.scrollTo(0, 0);\r\n    setVH(); */\r\n  }, {passive: true});\r\n}\r\n\r\nexport default function fixSafariStickyInputFocusing(input: HTMLElement) {\r\n  if(!IS_STICKY_INPUT_BUGGED) return;\r\n  input.classList.add('is-sticky-input-bugged');\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pause from \"../schedulers/pause\";\r\n\r\nconst texts = ['b', 'б'];\r\ntype FontType = 'text' | 'icons' | 'monospace';\r\n\r\nconst cache: {\r\n  [key: string]: {\r\n    [text: string]: Promise<any>\r\n  }\r\n} = {};\r\n\r\nconst fonts: {[type in FontType]: string} = {\r\n  text: 'Roboto',\r\n  icons: 'tgico',\r\n  monospace: 'Roboto Mono'\r\n};\r\n\r\nexport default function loadFonts(types: {[type in FontType]?: string[] | 'all'} = {\r\n  text: texts,\r\n  icons: undefined,\r\n  monospace: texts\r\n}): Promise<any> {\r\n  if(!('fonts' in document)) {\r\n    return Promise.resolve();\r\n  }\r\n  \r\n  const promises: Promise<any>[] = [];\r\n  for(const type in types) {\r\n    let _texts = types[type as FontType];\r\n    if(_texts === 'all') {\r\n      _texts = texts;\r\n    }\r\n\r\n    const font = fonts[type as FontType];\r\n    const weights = type === 'icons' ? [500] : [400, 500];\r\n    for(const weight of weights) {\r\n      const _promises = (_texts || [undefined]).map((text) => {\r\n        const key = [weight, '1rem', font].join(' ');\r\n        const promise = (cache[key] ??= {})[text || ''] ??= document.fonts.load(key, text);\r\n        return promise;\r\n      });\r\n      promises.push(..._promises);\r\n    }\r\n  }\r\n\r\n  return Promise.race([\r\n    Promise.all(promises),\r\n    pause(1000)\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from \"../environment/touchSupport\";\r\nimport EventListenerBase from \"./eventListenerBase\";\r\n\r\nconst FOCUS_EVENT_NAME = IS_TOUCH_SUPPORTED ? 'touchstart' : 'mousemove';\r\n\r\nexport class IdleController extends EventListenerBase<{\r\n  change: (idle: boolean) => void\r\n}> {\r\n  private _isIdle: boolean;\r\n\r\n  private focusPromise: Promise<void>;\r\n  private focusResolve: () => void;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this._isIdle = true;\r\n    this.focusPromise = Promise.resolve();\r\n    this.focusResolve = () => {};\r\n\r\n    window.addEventListener('blur', () => {\r\n      this.isIdle = true;\r\n      \r\n      window.addEventListener('focus', () => {\r\n        this.isIdle = false;\r\n      }, {once: true});\r\n    });\r\n\r\n    // * Prevent setting online after reloading page\r\n    window.addEventListener(FOCUS_EVENT_NAME, () => {\r\n      this.isIdle = false;\r\n    }, {once: true, passive: true});\r\n\r\n    this.addEventListener('change', (idle) => {\r\n      if(idle) {\r\n        this.focusPromise = new Promise((resolve) => {\r\n          this.focusResolve = resolve;\r\n        });\r\n      } else {\r\n        this.focusResolve();\r\n      }\r\n    });\r\n  }\r\n\r\n  public getFocusPromise() {\r\n    return this.focusPromise;\r\n  }\r\n\r\n  public get isIdle() {\r\n    return this._isIdle;\r\n  }\r\n\r\n  public set isIdle(value: boolean) {\r\n    if(this._isIdle === value) {\r\n      return;\r\n    }\r\n\r\n    this._isIdle = value;\r\n    this.dispatchEvent('change', value);\r\n  }\r\n}\r\n\r\nconst idleController = new IdleController();\r\nexport default idleController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport EventListenerBase from \"./eventListenerBase\";\r\n\r\nexport class OverlayCounter extends EventListenerBase<{\r\n  change: (isActive: boolean) => void\r\n}> {\r\n  public overlaysActive = 0;\r\n\r\n  get isOverlayActive() {\r\n    return this.overlaysActive > 0;\r\n  }\r\n\r\n  set isOverlayActive(value: boolean) {\r\n    this.overlaysActive += value ? 1 : -1;\r\n    this.dispatchEvent('change', this.isOverlayActive);\r\n  }\r\n}\r\n\r\nconst overlayCounter = new OverlayCounter();\r\nexport default overlayCounter;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's schedulers\r\nimport { NoneToVoidFunction } from \"../types\";\r\n\r\n/*\r\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\r\n  return throttleWith(onTickEnd, fn);\r\n}\r\n\r\nexport function throttleWithNow<F extends AnyToVoidFunction>(fn: F) {\r\n  return throttleWith(runNow, fn);\r\n}\r\n\r\nexport function onTickEnd(cb: NoneToVoidFunction) {\r\n  Promise.resolve().then(cb);\r\n}\r\n\r\nfunction runNow(fn: NoneToVoidFunction) {\r\n  fn();\r\n} */\r\n\r\nlet fastRafCallbacks: NoneToVoidFunction[] | undefined;\r\nexport function fastRaf(callback: NoneToVoidFunction) {\r\n  if(!fastRafCallbacks) {\r\n    fastRafCallbacks = [callback];\r\n\r\n    requestAnimationFrame(() => {\r\n      const currentCallbacks = fastRafCallbacks!;\r\n      fastRafCallbacks = undefined;\r\n      currentCallbacks.forEach((cb) => cb());\r\n    });\r\n  } else {\r\n    fastRafCallbacks.push(callback);\r\n  }\r\n}\r\n\r\nlet fastRafConventionalCallbacks: NoneToVoidFunction[] | undefined, processing = false;\r\nexport function fastRafConventional(callback: NoneToVoidFunction) {\r\n  if(!fastRafConventionalCallbacks) {\r\n    fastRafConventionalCallbacks = [callback];\r\n\r\n    requestAnimationFrame(() => {\r\n      processing = true;\r\n      for(let i = 0; i < fastRafConventionalCallbacks.length; ++i) {\r\n        fastRafConventionalCallbacks[i]();\r\n      }\r\n\r\n      fastRafConventionalCallbacks = undefined;\r\n      processing = false;\r\n    });\r\n  } else if(processing) {\r\n    callback();\r\n  } else {\r\n    fastRafConventionalCallbacks.push(callback);\r\n  }\r\n}\r\n\r\nlet rafPromise: Promise<void>;\r\nexport function fastRafPromise() {\r\n  if(rafPromise) return rafPromise;\r\n\r\n  rafPromise = new Promise<void>((resolve) => fastRaf(() => resolve()));\r\n  rafPromise.then(() => {\r\n    rafPromise = undefined;\r\n  });\r\n\r\n  return rafPromise;\r\n}\r\n\r\nexport function doubleRaf() {\r\n  return new Promise<void>((resolve) => {\r\n    fastRaf(() => {\r\n      fastRaf(resolve);\r\n    });\r\n  });\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type { Theme } from \"../config/state\";\r\nimport IS_TOUCH_SUPPORTED from \"../environment/touchSupport\";\r\nimport rootScope from \"../lib/rootScope\";\r\nimport { hslaStringToHex } from \"./color\";\r\n\r\nexport class ThemeController {\r\n  private themeColor: string;\r\n  private _themeColorElem: Element;\r\n  private systemTheme: Theme['name'];\r\n\r\n  constructor() {\r\n    rootScope.addEventListener('theme_change', () => {\r\n      this.setTheme();\r\n    });\r\n\r\n    // rootScope.addEventListener('settings_updated', ())\r\n  }\r\n\r\n  private get themeColorElem() {\r\n    if(this._themeColorElem !== undefined) {\r\n      return this._themeColorElem;\r\n    }\r\n\r\n    return this._themeColorElem = document.head.querySelector('[name=\"theme-color\"]') as Element || null;\r\n  }\r\n\r\n  public setThemeColor(color = this.themeColor) {\r\n    if(!color) {\r\n      color = this.isNight() ? '#212121' : '#ffffff';\r\n    }\r\n\r\n    const themeColorElem = this.themeColorElem;\r\n    if(themeColorElem) {\r\n      themeColorElem.setAttribute('content', color);\r\n    }\r\n  }\r\n\r\n  public setThemeListener() {\r\n    try {\r\n      const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n      const checkDarkMode = () => {\r\n        //const theme = this.getTheme();\r\n        this.systemTheme = darkModeMediaQuery.matches ? 'night' : 'day';\r\n        //const newTheme = this.getTheme();\r\n\r\n        if(rootScope.myId) {\r\n          rootScope.dispatchEvent('theme_change');\r\n        } else {\r\n          this.setTheme();\r\n        }\r\n      };\r\n\r\n      if('addEventListener' in darkModeMediaQuery) {\r\n        darkModeMediaQuery.addEventListener('change', checkDarkMode);\r\n      } else if('addListener' in darkModeMediaQuery) {\r\n        (darkModeMediaQuery as any).addListener(checkDarkMode);\r\n      }\r\n\r\n      checkDarkMode();\r\n    } catch(err) {\r\n\r\n    }\r\n  }\r\n\r\n  public applyHighlightningColor() {\r\n    let hsla: string;\r\n    const theme = themeController.getTheme();\r\n    if(theme.background.highlightningColor) {\r\n      hsla = theme.background.highlightningColor;\r\n      document.documentElement.style.setProperty('--message-highlightning-color', hsla);\r\n    } else {\r\n      document.documentElement.style.removeProperty('--message-highlightning-color');\r\n    }\r\n\r\n    if(!IS_TOUCH_SUPPORTED && hsla) {\r\n      themeController.themeColor = hslaStringToHex(hsla);\r\n    }\r\n  }\r\n\r\n  public setTheme() {\r\n    const isNight = this.isNight();\r\n    const colorScheme = document.head.querySelector('[name=\"color-scheme\"]');\r\n    if(colorScheme) {\r\n      colorScheme.setAttribute('content', isNight ? 'dark' : 'light');\r\n    }\r\n\r\n    document.documentElement.classList.toggle('night', isNight);\r\n    this.setThemeColor();\r\n\r\n    this.applyHighlightningColor();\r\n  }\r\n\r\n  public isNight() {\r\n    return this.getTheme().name === 'night';\r\n  }\r\n\r\n  public getTheme(name: Theme['name'] = rootScope.settings.theme === 'system' ? this.systemTheme : rootScope.settings.theme) {\r\n    return rootScope.settings.themes.find((t) => t.name === name);\r\n  }\r\n}\r\n\r\nconst themeController = new ThemeController();\r\nexport default themeController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function setWorkerProxy() {\r\n  // * hook worker constructor to set search parameters (test, debug, etc)\r\n  const workerHandler = {\r\n    construct(target: any, args: any) {\r\n      //console.log(target, args);\r\n      const url = args[0] + location.search;\r\n\r\n      return new target(url);\r\n    }\r\n  };\r\n\r\n  [\r\n    Worker, \r\n    typeof(SharedWorker) !== 'undefined' && SharedWorker\r\n  ].forEach((w) => {\r\n    if(!w) return;\r\n    window[w.name as any] = new Proxy(w, workerHandler);\r\n  });\r\n}\r\n\r\nsetWorkerProxy();\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport App from './config/app';\r\nimport blurActiveElement from './helpers/dom/blurActiveElement';\r\nimport cancelEvent from './helpers/dom/cancelEvent';\r\nimport { IS_STICKY_INPUT_BUGGED } from './helpers/dom/fixSafariStickyInputFocusing';\r\nimport loadFonts from './helpers/dom/loadFonts';\r\nimport IS_EMOJI_SUPPORTED from './environment/emojiSupport';\r\nimport { IS_ANDROID, IS_APPLE, IS_APPLE_MOBILE, IS_FIREFOX, IS_MOBILE, IS_MOBILE_SAFARI, IS_SAFARI } from './environment/userAgent';\r\nimport './materialize.scss';\r\nimport './scss/style.scss';\r\nimport pause from './helpers/schedulers/pause';\r\nimport setWorkerProxy from './helpers/setWorkerProxy';\r\nimport toggleAttributePolyfill from './helpers/dom/toggleAttributePolyfill';\r\nimport rootScope from './lib/rootScope';\r\nimport IS_TOUCH_SUPPORTED from './environment/touchSupport';\r\nimport I18n from './lib/langPack';\r\nimport './helpers/peerIdPolyfill';\r\nimport './lib/polyfill';\r\nimport apiManagerProxy from './lib/mtproto/mtprotoworker';\r\nimport getProxiedManagers from './lib/appManagers/getProxiedManagers';\r\nimport themeController from './helpers/themeController';\r\nimport overlayCounter from './helpers/overlayCounter';\r\nimport singleInstance from './lib/mtproto/singleInstance';\r\n\r\ndocument.addEventListener('DOMContentLoaded', async() => {\r\n  toggleAttributePolyfill();\r\n\r\n  rootScope.managers = getProxiedManagers();\r\n\r\n  const manifest = document.getElementById('manifest') as HTMLLinkElement;\r\n  manifest.href = `site${IS_APPLE && !IS_APPLE_MOBILE ? '_apple' : ''}.webmanifest?v=jw3mK7G9Aq`;\r\n\r\n  singleInstance.start();\r\n\r\n  // We listen to the resize event (https://css-tricks.com/the-trick-to-viewport-units-on-mobile/)\r\n  const w = window.visualViewport || window; // * handle iOS keyboard\r\n  let setViewportVH = false/* , hasFocus = false */;\r\n  let lastVH: number;\r\n  const setVH = () => {\r\n    const vh = (setViewportVH && !overlayCounter.isOverlayActive ? (w as VisualViewport).height || (w as Window).innerHeight : window.innerHeight) * 0.01;\r\n    if(lastVH === vh) {\r\n      return;\r\n    } else if(IS_TOUCH_SUPPORTED && lastVH < vh && (vh - lastVH) > 1) {\r\n      blurActiveElement(); // (Android) fix blurring inputs when keyboard is being closed (e.g. closing keyboard by back arrow and touching a bubble)\r\n    }\r\n\r\n    lastVH = vh;\r\n\r\n    //const vh = document.documentElement.scrollHeight * 0.01;\r\n    document.documentElement.style.setProperty('--vh', `${vh}px`);\r\n\r\n    //console.log('setVH', vh, setViewportVH ? w : window);\r\n\r\n    /* if(setViewportVH && userAgent.isSafari && touchSupport.isTouchSupported && document.activeElement && (document.activeElement as HTMLElement).blur) {\r\n      const rect = document.activeElement.getBoundingClientRect();\r\n      if(rect.top < 0 || rect.bottom >= (w as any).height) {\r\n        fastSmoothScroll(findUpClassName(document.activeElement, 'scrollable-y') || window as any, document.activeElement as HTMLElement, 'center', 4, undefined, FocusDirection.Static);\r\n      }\r\n    } */\r\n  };\r\n\r\n  setWorkerProxy;\r\n\r\n  // const [_, touchSupport, userAgent, _rootScope, _appStateManager, _I18n, __/* , ___ */] = await Promise.all([\r\n  //   import('./lib/polyfill'),\r\n  //   import('./environment/touchSupport'),\r\n  //   import('./environment/userAgent'),\r\n  //   import('./lib/rootScope'),\r\n  //   import('./lib/appManagers/appStateManager'),\r\n  //   import('./lib/langPack'),\r\n  //   import('./helpers/peerIdPolyfill'),\r\n  //   // import('./helpers/cacheFunctionPolyfill')\r\n  // ]);\r\n\r\n  /* const {IS_TOUCH_SUPPORTED} = touchSupport;\r\n  const {IS_FIREFOX, IS_MOBILE, IS_APPLE, IS_SAFARI, IS_APPLE_MOBILE, IS_ANDROID} = userAgent;\r\n  const rootScope = _rootScope.default;\r\n  const appStateManager = _appStateManager.default;\r\n  const I18n = _I18n.default; */\r\n\r\n  window.addEventListener('resize', setVH);\r\n  setVH();\r\n\r\n  if(IS_STICKY_INPUT_BUGGED) {\r\n    const toggleResizeMode = () => {\r\n      setViewportVH = tabId === 1 && IS_STICKY_INPUT_BUGGED && !overlayCounter.isOverlayActive;\r\n      setVH();\r\n\r\n      if(w !== window) {\r\n        if(setViewportVH) {\r\n          window.removeEventListener('resize', setVH);\r\n          w.addEventListener('resize', setVH);\r\n        } else {\r\n          w.removeEventListener('resize', setVH);\r\n          window.addEventListener('resize', setVH);\r\n        }\r\n      }\r\n    };\r\n\r\n    let tabId: number;\r\n    (window as any).onImTabChange = (id: number) => {\r\n      const wasTabId = tabId !== undefined;\r\n      tabId = id;\r\n\r\n      if(wasTabId || tabId === 1) {\r\n        toggleResizeMode();\r\n      }\r\n    };\r\n    \r\n    overlayCounter.addEventListener('change', () => {\r\n      toggleResizeMode();\r\n    });\r\n  }\r\n\r\n  if(IS_FIREFOX && !IS_EMOJI_SUPPORTED) {\r\n    document.addEventListener('dragstart', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if(target.tagName === 'IMG' && target.classList.contains('emoji')) {\r\n        cancelEvent(e);\r\n        return false;\r\n      }\r\n    });\r\n  }\r\n\r\n  // prevent firefox image dragging\r\n  document.addEventListener('dragstart', (e) => {\r\n    if((e.target as HTMLElement)?.tagName === \"IMG\") {\r\n      e.preventDefault();\r\n      return false;\r\n    }\r\n  });\r\n\r\n  // restrict contextmenu on images (e.g. webp stickers)\r\n  document.addEventListener('contextmenu', (e) => {\r\n    if((e.target as HTMLElement).tagName === 'IMG' && !(window as any).appMediaViewer) {\r\n      cancelEvent(e);\r\n    }\r\n  });\r\n\r\n  if(IS_FIREFOX) {\r\n    document.documentElement.classList.add('is-firefox', 'no-backdrop');\r\n  }\r\n\r\n  if(IS_MOBILE) {\r\n    document.documentElement.classList.add('is-mobile');\r\n  }\r\n\r\n  if(IS_APPLE) {\r\n    if(IS_SAFARI) {\r\n      document.documentElement.classList.add('is-safari');\r\n    }\r\n    \r\n    // document.documentElement.classList.add('emoji-supported');\r\n\r\n    if(IS_APPLE_MOBILE) {\r\n      document.documentElement.classList.add('is-ios');\r\n    } else {\r\n      document.documentElement.classList.add('is-mac');\r\n    }\r\n  } else if(IS_ANDROID) {\r\n    document.documentElement.classList.add('is-android');\r\n\r\n    /* document.addEventListener('focusin', (e) => {\r\n      hasFocus = true;\r\n      focusTime = Date.now();\r\n    }, {passive: true});\r\n\r\n    document.addEventListener('focusout', () => {\r\n      hasFocus = false;\r\n    }, {passive: true}); */\r\n  }\r\n\r\n  if(!IS_TOUCH_SUPPORTED) {\r\n    document.documentElement.classList.add('no-touch');\r\n  } else {\r\n    document.documentElement.classList.add('is-touch');\r\n    /* document.addEventListener('touchmove', (event: any) => {\r\n      event = event.originalEvent || event;\r\n      if(event.scale && event.scale !== 1) {\r\n        event.preventDefault();\r\n      }\r\n    }, {capture: true, passive: false}); */\r\n  }\r\n\r\n  let perf = performance.now();\r\n\r\n  // await pause(1000000);\r\n\r\n  const langPromise = I18n.getCacheLangPack();\r\n  \r\n  const [stateResult, langPack] = await Promise.all([\r\n    // loadState(),\r\n    apiManagerProxy.sendState().then(([stateResult]) => stateResult),\r\n    langPromise\r\n  ]);\r\n  I18n.setTimeFormat(stateResult.state.settings.timeFormat);\r\n\r\n  themeController.setThemeListener();\r\n\r\n  if(langPack.appVersion !== App.langPackVersion) {\r\n    I18n.getLangPack(langPack.lang_code);\r\n  }\r\n\r\n  /**\r\n   * won't fire if font is loaded too fast\r\n   */\r\n  function fadeInWhenFontsReady(elem: HTMLElement, promise: Promise<any>) {\r\n    elem.style.opacity = '0';\r\n\r\n    promise.then(() => {\r\n      window.requestAnimationFrame(() => {\r\n        elem.style.opacity = '';\r\n      });\r\n    });\r\n  }\r\n\r\n  console.log('got state, time:', performance.now() - perf);\r\n\r\n  const authState = stateResult.state.authState;\r\n  if(authState._ !== 'authStateSignedIn'/*  || 1 === 1 */) {\r\n    console.log('Will mount auth page:', authState._, Date.now() / 1000);\r\n\r\n    const el = document.getElementById('auth-pages');\r\n    let scrollable: HTMLElement;\r\n    if(el) {\r\n      scrollable = el.querySelector('.scrollable') as HTMLElement;\r\n      if((!IS_TOUCH_SUPPORTED || IS_MOBILE_SAFARI)) {\r\n        scrollable.classList.add('no-scrollbar');\r\n      }\r\n\r\n      // * don't remove this line\r\n      scrollable.style.opacity = '0';\r\n\r\n      const placeholder = document.createElement('div');\r\n      placeholder.classList.add('auth-placeholder');\r\n\r\n      scrollable.prepend(placeholder);\r\n      scrollable.append(placeholder.cloneNode());\r\n    }\r\n\r\n    try {\r\n      await Promise.all([\r\n        import('./lib/mtproto/telegramMeWebManager'),\r\n        import('./lib/mtproto/webPushApiManager')\r\n      ]).then(([meModule, pushModule]) => {\r\n        meModule.default.setAuthorized(false);\r\n        pushModule.default.forceUnsubscribe();\r\n      });\r\n    } catch(err) {\r\n      \r\n    }\r\n\r\n    let pagePromise: Promise<void>;\r\n    //langPromise.then(async() => {\r\n      switch(authState._) {\r\n        case 'authStateSignIn': \r\n          pagePromise = (await import('./pages/pageSignIn')).default.mount();\r\n          break;\r\n        case 'authStateSignQr': \r\n          pagePromise = (await import('./pages/pageSignQR')).default.mount();\r\n          break;\r\n        case 'authStateAuthCode':\r\n          pagePromise = (await import('./pages/pageAuthCode')).default.mount(authState.sentCode);\r\n          break;\r\n        case 'authStatePassword':\r\n          pagePromise = (await import('./pages/pagePassword')).default.mount();\r\n          break;\r\n        case 'authStateSignUp':\r\n          pagePromise = (await import('./pages/pageSignUp')).default.mount(authState.authCode);\r\n          break;\r\n      }\r\n    //});\r\n\r\n    if(scrollable) {\r\n      // wait for text appear\r\n      if(pagePromise) {\r\n        await pagePromise;\r\n      }\r\n\r\n      const promise = 'fonts' in document ? \r\n        Promise.race([\r\n          pause(1000), \r\n          document.fonts.ready\r\n        ]) : \r\n        Promise.resolve();\r\n      fadeInWhenFontsReady(scrollable, promise);\r\n    }\r\n\r\n    /* setTimeout(async() => {\r\n      (await import('./pages/pageAuthCode')).default.mount({\r\n        \"_\": \"auth.sentCode\",\r\n        \"pFlags\": {},\r\n        \"flags\": 6,\r\n        \"type\": {\r\n          \"_\": \"auth.sentCodeTypeSms\",\r\n          \"length\": 5\r\n        },\r\n        \"phone_code_hash\": \"\",\t\r\n        \"next_type\": {\r\n          \"_\": \"auth.codeTypeCall\"\r\n        },\r\n        \"timeout\": 120,\r\n        \"phone_number\": \"\"\r\n      });\r\n\r\n      (await import('./pages/pageSignQR')).default.mount();\r\n\r\n      (await import('./pages/pagePassword')).default.mount();\r\n\r\n      (await import('./pages/pageSignUp')).default.mount({\r\n        \"phone_code_hash\": \"\",\t\r\n        \"phone_number\": \"\"\r\n      });\r\n    }, 500); */\r\n  } else {\r\n    console.log('Will mount IM page:', Date.now() / 1000);\r\n    fadeInWhenFontsReady(document.getElementById('main-columns'), loadFonts());\r\n    (await import('./pages/pageIm')).default.mount();\r\n  }\r\n});\r\n","export default function toggleAttributePolyfill() {\r\n  if(!Element.prototype.toggleAttribute) {\r\n    Element.prototype.toggleAttribute = function(name, force) {\r\n      if(force !== void 0) force = !!force;\r\n      \r\n      if(this.hasAttribute(name)) {\r\n        if(force) return true;\r\n  \r\n        this.removeAttribute(name);\r\n        return false;\r\n      }\r\n      if(force === false) return false;\r\n        \r\n      this.setAttribute(name, \"\");\r\n      return true;\r\n    };\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nexport class AppRuntimeManager {\r\n  public reload() {\r\n    try {\r\n      location.reload();\r\n    } catch(e) {};\r\n\r\n    // if(window.chrome && chrome.runtime && chrome.runtime.reload) {\r\n    //   chrome.runtime.reload();\r\n    // }\r\n  }\r\n\r\n  public close() {\r\n    try {\r\n      window.close();\r\n    } catch(e) {}\r\n  }\r\n\r\n  /**\r\n   * Better to call from event\r\n   */\r\n  public focus() {\r\n    // // @ts-ignore\r\n    // if(window.navigator.mozApps && document.hidden) {\r\n    //   // Get app instance and launch it to bring app to foreground\r\n    //   // @ts-ignore\r\n    //   window.navigator.mozApps.getSelf().onsuccess = function() {\r\n    //     this.result.launch();\r\n    //   };\r\n    // } else {\r\n    //   // @ts-ignore\r\n    //   if(window.chrome && chrome.app && chrome.app.window) {\r\n    //     // @ts-ignore\r\n    //     chrome.app.window.current().focus();\r\n    //   }\r\n\r\n      window.focus();\r\n    // }\r\n  }\r\n}\r\n\r\nconst appRuntimeManager = new AppRuntimeManager();\r\nexport default appRuntimeManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type createManagers from \"./createManagers\";\r\nimport { ModifyFunctionsToAsync } from \"../../types\";\r\nimport apiManagerProxy from \"../mtproto/mtprotoworker\";\r\nimport { AckedResult } from \"../mtproto/superMessagePort\";\r\nimport noop from \"../../helpers/noop\";\r\nimport dT from \"../../helpers/dT\";\r\n\r\n// let stats: {\r\n//   [manager: string]: {\r\n//     [method: string]: {\r\n//       times: number[],\r\n//       byArgs: {\r\n//         [args: string]: number[]\r\n//       }\r\n//     }\r\n//   }\r\n// } = {};\r\n\r\n// let sentCount = 0;\r\n// let sentMethods: {[key: string]: number} = {};\r\n// let sentMethods2: {[key: string]: number} = {};\r\n// function collectStats(manager: string, method: string, args: any[], promise: Promise<any>) {\r\n//   ++sentCount;\r\n\r\n//   const key = [manager, method].join('-');\r\n//   if(!sentMethods[key]) sentMethods[key] = 0;\r\n//   ++sentMethods[key];\r\n\r\n//   const key2 = [('00000' + sentCount).slice(-5), key].join('-');\r\n\r\n//   let byManager = stats[manager] ??= {};\r\n//   let byMethod = byManager[method] ??= {times: [], byArgs: {}};\r\n\r\n//   const perf = performance.now();\r\n//   promise.catch(noop).finally(() => {\r\n//     const time = performance.now() - perf;\r\n//     byMethod.times.push(time);\r\n\r\n//     sentMethods2[key2] = time;\r\n\r\n//     try {\r\n//       const argsString = JSON.stringify(args);\r\n//       byMethod.byArgs[argsString].push(time);\r\n//     } catch(err) {}\r\n//   });\r\n// }\r\n\r\n// setInterval(() => {\r\n//   // console.log(dT(), '[PROXY] stats', stats, sentCount, sentMethods, sentMethods2);\r\n//   sentCount = 0;\r\n//   sentMethods = {};\r\n//   sentMethods2 = {};\r\n// }, 2000);\r\n\r\nfunction createProxy(/* source: T,  */name: string, ack?: boolean) {\r\n  const proxy = new Proxy({}, {\r\n    get: (target, p, receiver) => {\r\n      // console.log('get', target, p, receiver);\r\n      // @ts-ignore\r\n      // const value = source[p];\r\n      // if(typeof(value) !== 'function') {\r\n      //   return value;\r\n      // }\r\n\r\n      return (...args: any[]) => {\r\n        const promise = apiManagerProxy.invoke('manager', {\r\n          name,\r\n          method: p as string,\r\n          args\r\n        }, ack as any);\r\n\r\n        // collectStats(name, p as string, args, promise);\r\n\r\n        return promise;\r\n\r\n        // @ts-ignore\r\n        // return Promise.resolve(value.call(source, ...args));\r\n      };\r\n    }\r\n  });\r\n\r\n  return proxy;\r\n}\r\n\r\ntype AA<T> = {\r\n  [key in keyof T]: T[key] extends (...args: infer A) => infer R ? (...args: A) => Promise<AckedResult<Awaited<R>>> : never\r\n};\r\n\r\ntype T = Awaited<ReturnType<typeof createManagers>>;\r\nexport default function getProxiedManagers() {\r\n  let proxied: {\r\n    [name in keyof T]?: ModifyFunctionsToAsync<T[name]>;\r\n  } & {\r\n    acknowledged?: {\r\n      [name in keyof T]?: AA<T[name]>;\r\n    }\r\n  };\r\n\r\n  function createProxyProxy(proxied: any, ack?: boolean) {\r\n    return new Proxy(proxied, {\r\n      get: (target, p, receiver) => {\r\n        // @ts-ignore\r\n        return target[p] ??= createProxy(p as string, ack);\r\n      }\r\n    });\r\n  }\r\n\r\n  proxied = createProxyProxy({}, false);\r\n\r\n  proxied.acknowledged = createProxyProxy({}, true);\r\n\r\n  return proxied;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport { Database } from '../config/databases';\r\nimport Modes from '../config/modes';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport { logger } from './logger';\r\n\r\n/**\r\n * https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore/createIndex\r\n */\r\nexport type IDBIndex = {\r\n  indexName: string,\r\n  keyPath: string,\r\n  objectParameters: IDBIndexParameters\r\n};\r\n\r\nexport type IDBStore = {\r\n  name: string, \r\n  indexes?: IDBIndex[]\r\n};\r\n\r\nexport type IDBOptions = {\r\n  name?: string,\r\n  storeName: string,\r\n  stores?: IDBStore[],\r\n  version?: number\r\n};\r\n\r\nconst DEBUG = false;\r\n\r\nexport class IDB {\r\n  private static INSTANCES: IDB[] = [];\r\n  private openDbPromise: Promise<IDBDatabase>;\r\n  private db: IDBDatabase;\r\n  private storageIsAvailable: boolean;\r\n  private log: ReturnType<typeof logger>;\r\n  private name: string;\r\n  private version: number;\r\n  private stores: IDBStore[];\r\n\r\n  constructor(db: Database<any>) {\r\n    safeAssign(this, db);\r\n\r\n    if(Modes.test) {\r\n      this.name += '_test';\r\n    }\r\n\r\n    this.storageIsAvailable = true;\r\n    this.log = logger(['IDB', db.name].join('-'));\r\n    this.log('constructor');\r\n\r\n    this.openDatabase(true);\r\n\r\n    IDB.INSTANCES.push(this);\r\n  }\r\n\r\n  public isAvailable() {\r\n    return this.storageIsAvailable;\r\n  }\r\n\r\n  public openDatabase(createNew = false): Promise<IDBDatabase> {\r\n    if(this.openDbPromise && !createNew) {\r\n      return this.openDbPromise;\r\n    }\r\n\r\n    const createIndexes = (os: IDBObjectStore, store: IDBStore) => {\r\n      const indexNames = Array.from(os.indexNames);\r\n      for(const indexName of indexNames) {\r\n        os.deleteIndex(indexName);\r\n      }\r\n\r\n      if(!store.indexes?.length) {\r\n        return;\r\n      }\r\n\r\n      for(const index of store.indexes) {\r\n        if(os.indexNames.contains(index.indexName)) {\r\n          continue;\r\n        }\r\n\r\n        os.createIndex(index.indexName, index.keyPath, index.objectParameters);\r\n      }\r\n    };\r\n\r\n    const createObjectStore = (db: IDBDatabase, store: IDBStore) => {\r\n      const os = db.createObjectStore(store.name);\r\n      createIndexes(os, store);\r\n    };\r\n\r\n    try {\r\n      var request = indexedDB.open(this.name, this.version);\r\n\r\n      if(!request) {\r\n        return Promise.reject();\r\n      }\r\n    } catch(error) {\r\n      this.log.error('error opening db', (error as Error).message);\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    let finished = false;\r\n    setTimeout(() => {\r\n      if(!finished) {\r\n        request.onerror({type: 'IDB_CREATE_TIMEOUT'} as Event);\r\n      }\r\n    }, 3000);\r\n\r\n    return this.openDbPromise = new Promise<IDBDatabase>((resolve, reject) => {\r\n      request.onsuccess = (event) => {\r\n        finished = true;\r\n        const db = request.result;\r\n        let calledNew = false;\r\n\r\n        this.log('Opened');\r\n  \r\n        db.onerror = (error) => {\r\n          this.storageIsAvailable = false;\r\n          this.log.error('Error creating/accessing IndexedDB database', error);\r\n          reject(error);\r\n        };\r\n\r\n        db.onclose = (e) => {\r\n          this.log.error('closed:', e);\r\n          !calledNew && this.openDatabase();\r\n        };\r\n\r\n        db.onabort = (e) => {\r\n          this.log.error('abort:', e);\r\n          const transaction = e.target as IDBTransaction;\r\n          \r\n          this.openDatabase(calledNew = true);\r\n\r\n          if(transaction.onerror) {\r\n            transaction.onerror(e);\r\n          }\r\n\r\n          db.close();\r\n        };\r\n\r\n        db.onversionchange = (e) => {\r\n          this.log.error('onversionchange, lol?');\r\n        };\r\n\r\n        resolve(this.db = db);\r\n      };\r\n  \r\n      request.onerror = (event) => {\r\n        finished = true;\r\n        this.storageIsAvailable = false;\r\n        this.log.error('Error creating/accessing IndexedDB database', event);\r\n        reject(event);\r\n      };\r\n  \r\n      request.onupgradeneeded = (event) => {\r\n        finished = true;\r\n        this.log.warn('performing idb upgrade from', event.oldVersion, 'to', event.newVersion);\r\n\r\n        const target = event.target as IDBOpenDBRequest;\r\n        const db = target.result;\r\n        this.stores.forEach((store) => {\r\n          /* if(db.objectStoreNames.contains(store.name)) {\r\n            //if(event.oldVersion === 1) {\r\n              db.deleteObjectStore(store.name);\r\n            //}\r\n          } */\r\n    \r\n          if(!db.objectStoreNames.contains(store.name)) {\r\n            createObjectStore(db, store);\r\n          } else {\r\n            const txn = target.transaction;\r\n            const os = txn.objectStore(store.name);\r\n            createIndexes(os, store);\r\n          }\r\n        });\r\n      };\r\n    });\r\n  }\r\n\r\n  public static create<T extends Database<any>>(db: T) {\r\n    return this.INSTANCES.find((instance) => instance.name === db.name) ?? new IDB(db);\r\n  }\r\n\r\n  public static closeDatabases(preserve?: IDB) {\r\n    this.INSTANCES.forEach((storage) => {\r\n      if(preserve && preserve === storage) {\r\n        return;\r\n      }\r\n\r\n      const db = storage.db;\r\n      if(db) {\r\n        db.onclose = () => {};\r\n        db.close();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default class IDBStorage<T extends Database<any>, StoreName extends string = T['stores'][0]['name']> {\r\n  private log: ReturnType<typeof logger>;\r\n  private storeName: T['stores'][0]['name'];\r\n  private idb: IDB;\r\n\r\n  constructor(db: T, storeName: typeof db['stores'][0]['name']) {\r\n    this.storeName = storeName;\r\n    this.log = logger(['IDB', db.name, storeName].join('-'));\r\n    this.idb = IDB.create(db);\r\n  }\r\n\r\n  /**\r\n   * ! WARNING ! function requires at least one opened connection\r\n   */\r\n  /* public static clearObjectStores() {\r\n    const storage = this.STORAGES[0];\r\n    this.closeDatabases(storage);\r\n\r\n    const names = Array.from(storage.db.objectStoreNames);\r\n    const promises = names.map((name) => storage.clear(name));\r\n    return Promise.all(promises);\r\n  } */\r\n\r\n  /* public static deleteDatabase() {\r\n    this.closeDatabases();\r\n\r\n    const storages = this.STORAGES;\r\n    const dbNames = Array.from(new Set(storages.map((storage) => storage.name)));\r\n    const promises = dbNames.map((dbName) => {\r\n      return new Promise<void>((resolve, reject) => {\r\n        const deleteRequest = indexedDB.deleteDatabase(dbName);\r\n  \r\n        deleteRequest.onerror = () => {\r\n          reject();\r\n        };\r\n  \r\n        deleteRequest.onsuccess = () => {\r\n          resolve();\r\n        };\r\n      });\r\n    });\r\n\r\n    return Promise.all(promises);\r\n  } */\r\n\r\n  public delete(entryName: string | string[], storeName?: StoreName): Promise<void> {\r\n    //return Promise.resolve();\r\n    if(!Array.isArray(entryName)) {\r\n      entryName = [].concat(entryName);\r\n    }\r\n\r\n    return this.getObjectStore('readwrite', (objectStore) => {\r\n      return (entryName as string[]).map((entryName) => objectStore.delete(entryName));\r\n    }, DEBUG ? 'delete: ' + entryName.join(', ') : '', storeName);\r\n  }\r\n\r\n  public clear(storeName?: StoreName): Promise<void> {\r\n    return this.getObjectStore('readwrite', (objectStore) => objectStore.clear(), DEBUG ? 'clear' : '', storeName);\r\n  }\r\n\r\n  public save(entryName: string | string[], value: any | any[], storeName?: StoreName) {\r\n    // const handleError = (error: Error) => {\r\n    //   this.log.error('save: transaction error:', entryName, value, db, error, error && error.name);\r\n    //   if((!error || error.name === 'InvalidStateError')/*  && false */) {\r\n    //     setTimeout(() => {\r\n    //       this.save(entryName, value);\r\n    //     }, 2e3);\r\n    //   } else {\r\n    //     //console.error('IndexedDB saveFile transaction error:', error, error && error.name);\r\n    //   }\r\n    // };\r\n\r\n    if(!Array.isArray(entryName)) {\r\n      entryName = [].concat(entryName);\r\n      value = [].concat(value);\r\n    }\r\n    \r\n    return this.getObjectStore('readwrite', (objectStore) => {\r\n      return (entryName as string[]).map((entryName, idx) => objectStore.put(value[idx], entryName));\r\n    }, DEBUG ? 'save: ' + entryName.join(', ') : '', storeName);\r\n  }\r\n\r\n  // public saveFile(fileName: string, blob: Blob | Uint8Array) {\r\n  //   //return Promise.resolve(blobConstruct([blob]));\r\n  //   if(!(blob instanceof Blob)) {\r\n  //     blob = blobConstruct(blob);\r\n  //   }\r\n\r\n  //   return this.save(fileName, blob);\r\n  // }\r\n\r\n  /* public saveFileBase64(db: IDBDatabase, fileName: string, blob: Blob | any): Promise<Blob> {\r\n    if(this.getBlobSize(blob) > 10 * 1024 * 1024) {\r\n      return Promise.reject();\r\n    }\r\n\r\n    if(!(blob instanceof Blob)) {\r\n      var safeMimeType = blobSafeMimeType(blob.type || 'image/jpeg');\r\n      var address = 'data:' + safeMimeType + ';base64,' + bytesToBase64(blob);\r\n      return this.storagePutB64String(db, fileName, address).then(() => {\r\n        return blob;\r\n      });\r\n    }\r\n\r\n    try {\r\n      var reader = new FileReader();\r\n    } catch (e) {\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject();\r\n    }\r\n\r\n    let promise = new Promise<Blob>((resolve, reject) => {\r\n      reader.onloadend = () => {\r\n        this.storagePutB64String(db, fileName, reader.result as string).then(() => {\r\n          resolve(blob);\r\n        }, reject);\r\n      }\r\n  \r\n      reader.onerror = reject;\r\n    });\r\n    \r\n\r\n    try {\r\n      reader.readAsDataURL(blob);\r\n    } catch (e) {\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject();\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public storagePutB64String(db: IDBDatabase, fileName: string, b64string: string) {\r\n    try {\r\n      var objectStore = db.transaction([this.storeName], 'readwrite')\r\n        .objectStore(this.storeName);\r\n      var request = objectStore.put(b64string, fileName);\r\n    } catch(error) {\r\n      this.storageIsAvailable = false;\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      request.onsuccess = function(event) {\r\n        resolve();\r\n      };\r\n  \r\n      request.onerror = reject;\r\n    });\r\n  }\r\n\r\n  public getBlobSize(blob: any) {\r\n    return blob.size || blob.byteLength || blob.length;\r\n  } */\r\n\r\n  public get<T>(entryName: string[], storeName?: StoreName): Promise<T[]>;\r\n  public get<T>(entryName: string, storeName?: StoreName): Promise<T>;\r\n  public get<T>(entryName: string | string[], storeName?: StoreName): Promise<T> | Promise<T[]> {\r\n    //return Promise.reject();\r\n\r\n    if(!Array.isArray(entryName)) {\r\n      entryName = [].concat(entryName);\r\n    }\r\n\r\n    if(!entryName.length) {\r\n      return Promise.resolve([]) as any;\r\n    }\r\n\r\n    return this.getObjectStore<T>('readonly', (objectStore) => {\r\n      return (entryName as string[]).map((entryName) => objectStore.get(entryName));\r\n    }, DEBUG ? 'get: ' + entryName.join(', ') : '', storeName);\r\n  }\r\n\r\n  private getObjectStore<T>(\r\n    mode: IDBTransactionMode, \r\n    callback: (objectStore: IDBObjectStore) => IDBRequest | IDBRequest[], \r\n    log?: string, \r\n    storeName = this.storeName\r\n  ) {\r\n    let perf: number;\r\n\r\n    if(log) {\r\n      perf = performance.now();\r\n      this.log(log + ': start');\r\n    }\r\n\r\n    return this.idb.openDatabase().then((db) => {\r\n      return new Promise<T>((resolve, reject) => {\r\n        /* if(mode === 'readwrite') {\r\n          return;\r\n        } */\r\n\r\n        const transaction = db.transaction([storeName], mode);\r\n\r\n        const onError = () => {\r\n          clearTimeout(timeout);\r\n          reject(transaction.error);\r\n        };\r\n\r\n        // let resolved = false;\r\n        const onComplete = (/* what: string */) => {\r\n          clearTimeout(timeout);\r\n\r\n          if(log) {\r\n            this.log(log + ': end', performance.now() - perf/* , what */);\r\n          }\r\n\r\n          // if(resolved) {\r\n          //   return;\r\n          // }\r\n\r\n          // resolved = true;\r\n          const results = requests.map((r) => r.result);\r\n          resolve(isArray ? results : results[0]);\r\n        };\r\n\r\n        transaction.onerror = onError;\r\n\r\n        // * have to wait while clearing or setting something\r\n        const waitForTransactionComplete = mode === 'readwrite';\r\n        if(waitForTransactionComplete) {\r\n          transaction.oncomplete = () => onComplete(/* 'transaction' */);\r\n        }\r\n  \r\n        const timeout = setTimeout(() => {\r\n          this.log.error('transaction not finished', transaction, log);\r\n        }, 10000);\r\n  \r\n        /* transaction.addEventListener('abort', (e) => {\r\n          //handleError();\r\n          this.log.error('IndexedDB: transaction abort!', transaction.error);\r\n        }); */\r\n  \r\n        const callbackResult = callback(transaction.objectStore(storeName));\r\n\r\n        const isArray = Array.isArray(callbackResult);\r\n        const requests: IDBRequest[] = isArray ? callbackResult : [].concat(callbackResult) as any;\r\n\r\n        if(waitForTransactionComplete) {\r\n          return;\r\n        }\r\n\r\n        const length = requests.length;\r\n        let left = length;\r\n\r\n        const onRequestFinished = () => {\r\n          if(transaction.error) {\r\n            return;\r\n          }\r\n\r\n          if(!--left) {\r\n            onComplete(/* 'requests' */);\r\n          }\r\n        };\r\n\r\n        for(let i = 0; i < length; ++i) {\r\n          const request = requests[i];\r\n          request.onerror = onError;\r\n          request.onsuccess = onRequestFinished;\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  public getAll<T>(storeName?: StoreName): Promise<T[]> {\r\n    return this.getObjectStore<T[]>('readonly', (objectStore) => objectStore.getAll(), DEBUG ? 'getAll' : '', storeName);\r\n  }\r\n\r\n  /* public getAllKeys(): Promise<Array<string>> {\r\n    console.time('getAllEntries');\r\n    return this.openDatabase().then((db) => {\r\n      var objectStore = db.transaction([this.storeName], 'readonly')\r\n        .objectStore(this.storeName);\r\n      var request = objectStore.getAllKeys();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        request.onsuccess = function(event) {\r\n          // @ts-ignore\r\n          var result = event.target.result;\r\n          resolve(result);\r\n          console.timeEnd('getAllEntries');\r\n        }\r\n  \r\n        request.onerror = reject;\r\n      });\r\n    });\r\n  } */\r\n\r\n  /* public isFileExists(fileName: string): Promise<boolean> {\r\n    console.time('isFileExists');\r\n    return this.openDatabase().then((db) => {\r\n      var objectStore = db.transaction([this.storeName], 'readonly')\r\n        .objectStore(this.storeName);\r\n      var request = objectStore.openCursor(fileName);\r\n\r\n      return new Promise((resolve, reject) => {\r\n        request.onsuccess = function(event) {\r\n          // @ts-ignore\r\n          var cursor = event.target.result;\r\n          resolve(!!cursor);\r\n          console.timeEnd('isFileExists');\r\n        }\r\n  \r\n        request.onerror = reject;\r\n      });\r\n    });\r\n  } */\r\n\r\n  /* public getFileWriter(fileName: string, mimeType: string) {\r\n    var fakeWriter = FileManager.getFakeFileWriter(mimeType, (blob) => {\r\n      return this.saveFile(fileName, blob);\r\n    });\r\n\r\n    return Promise.resolve(fakeWriter);\r\n  } */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type lang from \"../lang\";\r\nimport type langSign from \"../langSign\";\r\nimport type { State } from \"../config/state\";\r\nimport DEBUG, { MOUNT_CLASS_TO } from \"../config/debug\";\r\nimport { HelpCountriesList, HelpCountry, LangPackDifference, LangPackString } from \"../layer\";\r\nimport stateStorage from \"./stateStorage\";\r\nimport App from \"../config/app\";\r\nimport rootScope from \"./rootScope\";\r\nimport { IS_MOBILE } from \"../environment/userAgent\";\r\nimport deepEqual from \"../helpers/object/deepEqual\";\r\nimport safeAssign from \"../helpers/object/safeAssign\";\r\nimport capitalizeFirstLetter from \"../helpers/string/capitalizeFirstLetter\";\r\nimport matchUrlProtocol from \"./richTextProcessor/matchUrlProtocol\";\r\nimport wrapUrl from \"./richTextProcessor/wrapUrl\";\r\n\r\nexport const langPack: {[actionType: string]: LangPackKey} = {\r\n  \"messageActionChatCreate\": \"ActionCreateGroup\",\r\n  \"messageActionChatCreateYou\": \"ActionYouCreateGroup\",\r\n\t\"messageActionChatEditTitle\": \"ActionChangedTitle\",\r\n\t\"messageActionChatEditPhoto\": \"ActionChangedPhoto\",\r\n\t\"messageActionChatEditVideo\": \"ActionChangedVideo\",\r\n\t\"messageActionChatDeletePhoto\": \"ActionRemovedPhoto\",\r\n\t\"messageActionChatReturn\": \"ActionAddUserSelf\",\r\n\t\"messageActionChatReturnYou\": \"ActionAddUserSelfYou\",\r\n\t\"messageActionChatJoined\": \"ActionAddUserSelfMega\",\r\n\t\"messageActionChatJoinedYou\": \"ChannelMegaJoined\",\r\n  \"messageActionChatAddUser\": \"ActionAddUser\",\r\n  \"messageActionChatAddUsers\": \"ActionAddUser\",\r\n\t\"messageActionChatLeave\": \"ActionLeftUser\",\r\n\t\"messageActionChatLeaveYou\": \"YouLeft\",\r\n\t\"messageActionChatDeleteUser\": \"ActionKickUser\",\r\n\t\"messageActionChatJoinedByLink\": \"ActionInviteUser\",\r\n  \"messageActionPinMessage\": \"Chat.Service.Group.UpdatedPinnedMessage\",\r\n  \"messageActionContactSignUp\": \"Chat.Service.PeerJoinedTelegram\",\r\n\t\"messageActionChannelCreate\": \"ActionCreateChannel\",\r\n\t\"messageActionChannelEditTitle\": \"Chat.Service.Channel.UpdatedTitle\",\r\n\t\"messageActionChannelEditPhoto\": \"Chat.Service.Channel.UpdatedPhoto\",\r\n\t\"messageActionChannelEditVideo\": \"Chat.Service.Channel.UpdatedVideo\",\r\n  \"messageActionChannelDeletePhoto\": \"Chat.Service.Channel.RemovedPhoto\",\r\n  \"messageActionHistoryClear\": \"HistoryCleared\",\r\n\t\"messageActionDiscussionStarted\": \"DiscussionStarted\",\r\n\r\n  \"messageActionChannelMigrateFrom\": \"ActionMigrateFromGroup\",\r\n\r\n  \"messageActionPhoneCall.video_in_ok\": \"ChatList.Service.VideoCall.incoming\",\r\n\t\"messageActionPhoneCall.video_out_ok\": \"ChatList.Service.VideoCall.outgoing\",\r\n\t\"messageActionPhoneCall.video_missed\": \"ChatList.Service.VideoCall.Missed\",\r\n\t\"messageActionPhoneCall.video_cancelled\": \"ChatList.Service.VideoCall.Cancelled\",\r\n  \"messageActionPhoneCall.in_ok\": \"ChatList.Service.Call.incoming\",\r\n\t\"messageActionPhoneCall.out_ok\": \"ChatList.Service.Call.outgoing\",\r\n\t\"messageActionPhoneCall.missed\": \"ChatList.Service.Call.Missed\",\r\n\t\"messageActionPhoneCall.cancelled\": \"ChatList.Service.Call.Cancelled\",\r\n\r\n\t\"messageActionGroupCall.started\": \"Chat.Service.VoiceChatStarted.Channel\",\r\n\t\"messageActionGroupCall.started_by\": \"Chat.Service.VoiceChatStarted\",\r\n\t\"messageActionGroupCall.started_byYou\": \"Chat.Service.VoiceChatStartedYou\",\r\n\t\"messageActionGroupCall.ended\": \"Chat.Service.VoiceChatFinished.Channel\",\r\n\t\"messageActionGroupCall.ended_by\": \"Chat.Service.VoiceChatFinished\",\r\n\t\"messageActionGroupCall.ended_byYou\": \"Chat.Service.VoiceChatFinishedYou\",\r\n\r\n\t\"messageActionBotAllowed\": \"Chat.Service.BotPermissionAllowed\",\r\n};\r\n\r\nexport type LangPackKey = /* string |  */keyof typeof lang | keyof typeof langSign;\r\n\r\nexport type FormatterArgument = string | number | Node | FormatterArgument[];\r\nexport type FormatterArguments = FormatterArgument[];\r\n\r\nexport const UNSUPPORTED_LANG_PACK_KEY: LangPackKey = IS_MOBILE ? 'Message.Unsupported.Mobile' : 'Message.Unsupported.Desktop';\r\n\r\nnamespace I18n {\r\n\texport const strings: Map<LangPackKey, LangPackString> = new Map();\r\n\texport const countriesList: HelpCountry[] = [];\r\n\tlet pluralRules: Intl.PluralRules;\r\n\r\n\tlet cacheLangPackPromise: Promise<LangPackDifference>;\r\n\texport let lastRequestedLangCode: string;\r\n  export let lastRequestedNormalizedLangCode: string;\r\n\texport let lastAppliedLangCode: string;\r\n\texport let requestedServerLanguage = false;\r\n  export let timeFormat: State['settings']['timeFormat'];\r\n\r\n  function setLangCode(langCode: string) {\r\n    lastRequestedLangCode = langCode;\r\n    lastRequestedNormalizedLangCode = langCode.split('-')[0];\r\n  }\r\n\r\n\texport function getCacheLangPack(): Promise<LangPackDifference> {\r\n\t\tif(cacheLangPackPromise) return cacheLangPackPromise;\r\n\t\treturn cacheLangPackPromise = Promise.all([\r\n\t\t\tstateStorage.get('langPack') as Promise<LangPackDifference>,\r\n\t\t\tpolyfillPromise\r\n\t\t]).then(([langPack]) => {\r\n\t\t\tif(!langPack/*  || true */) {\r\n\t\t\t\treturn loadLocalLangPack();\r\n\t\t\t} else if(DEBUG && false) {\r\n\t\t\t\treturn getLangPack(langPack.lang_code);\r\n\t\t\t}/*  else if(langPack.appVersion !== App.langPackVersion) {\r\n\t\t\t\treturn getLangPack(langPack.lang_code);\r\n\t\t\t} */\r\n\t\t\t\r\n\t\t\tif(!lastRequestedLangCode) {\r\n        setLangCode(langPack.lang_code);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tapplyLangPack(langPack);\r\n\t\t\treturn langPack;\r\n\t\t}).finally(() => {\r\n\t\t\tcacheLangPackPromise = undefined;\r\n\t\t});\r\n\t}\r\n\r\n  function updateAmPm() {\r\n    if(timeFormat === 'h12') {\r\n      try {\r\n        const dateTimeFormat = getDateTimeFormat({hour: 'numeric', minute: 'numeric', hour12: true});\r\n        const date = new Date();\r\n        date.setHours(0);\r\n        const amText = dateTimeFormat.format(date);\r\n        amPmCache.am = amText.split(' ')[1];\r\n        date.setHours(12);\r\n        const pmText = dateTimeFormat.format(date);\r\n        amPmCache.pm = pmText.split(' ')[1];\r\n      } catch(err) {\r\n        console.error('cannot get am/pm', err);\r\n        amPmCache = {am: 'AM', pm: 'PM'};\r\n      }\r\n    }\r\n  }\r\n\r\n  export function setTimeFormat(\r\n    format: State['settings']['timeFormat'],\r\n    haveToUpdate = !!timeFormat && timeFormat !== format\r\n  ) {\r\n    timeFormat = format;\r\n\r\n    updateAmPm();\r\n\r\n    if(haveToUpdate) {\r\n      cachedDateTimeFormats.clear();\r\n      const elements = Array.from(document.querySelectorAll(`.i18n`)) as HTMLElement[];\r\n      elements.forEach((element) => {\r\n        const instance = weakMap.get(element);\r\n\r\n        if(instance instanceof IntlDateElement) {\r\n          instance.update();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n\texport function loadLocalLangPack() {\r\n\t\tconst defaultCode = App.langPackCode;\r\n    setLangCode(defaultCode);\r\n\t\treturn Promise.all([\r\n\t\t\timport('../lang'),\r\n\t\t\timport('../langSign'),\r\n\t\t\timport('../countries')\r\n\t\t]).then(([lang, langSign, countries]) => {\r\n\t\t\tconst strings: LangPackString[] = [];\r\n\t\t\tformatLocalStrings(lang.default, strings);\r\n\t\t\tformatLocalStrings(langSign.default, strings);\r\n\r\n\t\t\tconst langPack: LangPackDifference = {\r\n\t\t\t\t_: 'langPackDifference',\r\n\t\t\t\tfrom_version: 0,\r\n\t\t\t\tlang_code: defaultCode,\r\n\t\t\t\tstrings,\r\n\t\t\t\tversion: 0,\r\n\t\t\t\tlocal: true,\r\n\t\t\t\tcountries: countries.default\r\n\t\t\t};\r\n\t\t\treturn saveLangPack(langPack);\r\n\t\t});\r\n\t}\r\n\r\n\texport function loadLangPack(langCode: string, web?: boolean) {\r\n\t\trequestedServerLanguage = true;\r\n    const managers = rootScope.managers;\r\n\t\treturn Promise.all([\r\n\t\t\tmanagers.apiManager.invokeApiCacheable('langpack.getLangPack', {\r\n\t\t\t\tlang_code: langCode,\r\n\t\t\t\tlang_pack: web ? 'web' : App.langPack\r\n\t\t\t}),\r\n\t\t\t!web && managers.apiManager.invokeApiCacheable('langpack.getLangPack', {\r\n\t\t\t\tlang_code: langCode,\r\n\t\t\t\tlang_pack: 'android'\r\n\t\t\t}),\r\n\t\t\timport('../lang'),\r\n\t\t\timport('../langSign'),\r\n\t\t\tmanagers.apiManager.invokeApiCacheable('help.getCountriesList', {\r\n\t\t\t\tlang_code: langCode,\r\n\t\t\t\thash: 0\r\n\t\t\t}) as Promise<HelpCountriesList.helpCountriesList>,\r\n\t\t\tpolyfillPromise,\r\n\t\t]);\r\n\t}\r\n\r\n\texport function getStrings(langCode: string, strings: string[]) {\r\n\t\treturn rootScope.managers.apiManager.invokeApi('langpack.getStrings', {\r\n\t\t\tlang_pack: App.langPack,\r\n\t\t\tlang_code: langCode,\r\n\t\t\tkeys: strings\r\n\t\t});\r\n\t}\r\n\r\n\texport function formatLocalStrings(strings: any, pushTo: LangPackString[] = []) {\r\n\t\tfor(const i in strings) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tconst v = strings[i];\r\n\t\t\tif(typeof(v) === 'string') {\r\n\t\t\t\tpushTo.push({\r\n\t\t\t\t\t_: 'langPackString',\r\n\t\t\t\t\tkey: i,\r\n\t\t\t\t\tvalue: v\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tpushTo.push({\r\n\t\t\t\t\t_: 'langPackStringPluralized',\r\n\t\t\t\t\tkey: i,\r\n\t\t\t\t\t...v\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn pushTo;\r\n\t}\r\n\r\n\texport function getLangPack(langCode: string, web?: boolean) {\r\n    setLangCode(langCode);\r\n\t\treturn loadLangPack(langCode, web).then(([langPack1, langPack2, localLangPack1, localLangPack2, countries, _]) => {\r\n\t\t\tlet strings: LangPackString[] = [];\r\n\r\n\t\t\t[localLangPack1, localLangPack2].forEach((l) => {\r\n\t\t\t\tformatLocalStrings(l.default as any, strings);\r\n\t\t\t});\r\n\r\n\t\t\tstrings = strings.concat(...[langPack1.strings, langPack2.strings].filter(Boolean));\r\n\r\n\t\t\tlangPack1.strings = strings;\r\n\t\t\tlangPack1.countries = countries;\r\n\t\t\treturn saveLangPack(langPack1);\r\n\t\t});\r\n\t}\r\n\r\n\texport function saveLangPack(langPack: LangPackDifference) {\r\n\t\tlangPack.appVersion = App.langPackVersion;\r\n\r\n\t\treturn stateStorage.set({langPack}).then(() => {\r\n\t\t\tapplyLangPack(langPack);\r\n\t\t\treturn langPack;\r\n\t\t});\r\n\t}\r\n\r\n\texport const polyfillPromise = (function checkIfPolyfillNeeded() {\r\n\t\tif(typeof(Intl) !== 'undefined' && typeof(Intl.PluralRules) !== 'undefined'/*  && false */) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t} else {\r\n\t\t\treturn import('./pluralPolyfill').then((_Intl) => {\r\n\t\t\t\t(window as any).Intl = Object.assign(typeof(Intl) !== 'undefined' ? Intl : {}, _Intl.default);\r\n\t\t\t});\r\n\t\t}\r\n\t})();\r\n\t\r\n\texport function applyLangPack(langPack: LangPackDifference) {\r\n    const currentLangCode = lastRequestedLangCode;\r\n\t\tif(langPack.lang_code !== currentLangCode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tpluralRules = new Intl.PluralRules(lastRequestedNormalizedLangCode);\r\n\t\t} catch(err) {\r\n\t\t\tconsole.error('pluralRules error', err);\r\n\t\t\tpluralRules = new Intl.PluralRules(lastRequestedNormalizedLangCode.split('-', 1)[0]);\r\n\t\t}\r\n\r\n\t\tstrings.clear();\r\n\r\n\t\tfor(const string of langPack.strings) {\r\n\t\t\tstrings.set(string.key as LangPackKey, string);\r\n\t\t}\r\n\r\n\t\tif(langPack.countries) {\r\n\t\t\tcountriesList.length = 0;\r\n\t\t\tcountriesList.push(...langPack.countries.countries);\r\n\r\n\t\t\tlangPack.countries.countries.forEach((country) => {\r\n\t\t\t\tif(country.name) {\r\n\t\t\t\t\tconst langPackKey: any = country.default_name;\r\n\t\t\t\t\tstrings.set(langPackKey, {\r\n\t\t\t\t\t\t_: 'langPackString',\r\n\t\t\t\t\t\tkey: langPackKey,\r\n\t\t\t\t\t\tvalue: country.name\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(lastAppliedLangCode !== currentLangCode) {\r\n\t\t\trootScope.dispatchEvent('language_change', currentLangCode);\r\n\t\t\tlastAppliedLangCode = currentLangCode;\r\n      cachedDateTimeFormats.clear();\r\n      updateAmPm();\r\n\t\t}\r\n\r\n\t\tconst elements = Array.from(document.querySelectorAll(`.i18n`)) as HTMLElement[];\r\n\t\telements.forEach((element) => {\r\n\t\t\tconst instance = weakMap.get(element);\r\n\r\n\t\t\tif(instance) {\r\n\t\t\t\tinstance.update();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n  function pushNextArgument(out: ReturnType<typeof superFormatter>, args: FormatterArguments, indexHolder: {i: number}) {\r\n    const arg = args[indexHolder.i++];\r\n\t\tif(Array.isArray(arg)) {\r\n\t\t\tout.push(...arg as any);\r\n\t\t} else {\r\n\t\t\tout.push(arg);\r\n\t\t}\r\n  }\r\n\r\n\texport function superFormatter(input: string, args?: FormatterArguments, indexHolder = {i: 0}): Exclude<FormatterArgument, FormatterArgument[]>[] {\r\n\t\tlet out: ReturnType<typeof superFormatter> = [];\r\n\t\tconst regExp = /(\\*\\*|__)(.+?)\\1|(\\n)|(\\[.+?\\]\\(.*?\\))|un\\d|%\\d\\$.|%./g;\r\n\r\n\t\tlet lastIndex = 0;\r\n\t\tinput.replace(regExp, (match, p1: any, p2: any, p3: any, p4: string, offset: number, string: string) => {\r\n\t\t\t//console.table({match, p1, p2, offset, string});\r\n\r\n\t\t\tout.push(string.slice(lastIndex, offset));\r\n\r\n\t\t\tif(p1) {\r\n\t\t\t\t//offset += p1.length;\r\n        let element: HTMLElement;\r\n\t\t\t\tswitch(p1) {\r\n\t\t\t\t\tcase '**': {\r\n            element = document.createElement('b');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n          case '__': {\r\n            element = document.createElement('i');\r\n            break;\r\n          }\r\n\t\t\t\t}\r\n\r\n        element.append(...superFormatter(p2, args, indexHolder) as any);\r\n        out.push(element);\r\n\t\t\t} else if(p3) {\r\n\t\t\t\tout.push(document.createElement('br'));\r\n\t\t\t} else if(p4) {\r\n        const idx = p4.lastIndexOf(']');\r\n\t\t\t\tconst text = p4.slice(1, idx);\r\n        \r\n\t\t\t\tconst url = p4.slice(idx + 2, p4.length - 1);\r\n        let a: HTMLAnchorElement;\r\n\t\t\t\tif(url && matchUrlProtocol(url)) {\r\n          a = document.createElement('a');\r\n          const wrappedUrl = wrapUrl(url);\r\n          a.href = wrappedUrl.url;\r\n          if(wrappedUrl.onclick) a.setAttribute('onclick', wrappedUrl.onclick);\r\n          a.target = '_blank';\r\n\t\t\t\t} else {\r\n          a = args[indexHolder.i++] as HTMLAnchorElement;\r\n          a.textContent = ''; // reset content\r\n        }\r\n\r\n        a.append(...superFormatter(text, args, indexHolder) as any);\r\n\r\n\t\t\t\tout.push(a);\r\n\t\t\t} else if(args) {\r\n        pushNextArgument(out, args, indexHolder);\r\n\t\t\t}\r\n\r\n\t\t\tlastIndex = offset + match.length;\r\n\t\t\treturn '';\r\n\t\t});\r\n\t\r\n\t\tif(lastIndex !== input.length) {\r\n\t\t\tout.push(input.slice(lastIndex));\r\n\t\t}\r\n\r\n\t\treturn out;\r\n\t}\r\n\t\r\n\texport function format(key: LangPackKey, plain: true, args?: FormatterArguments): string;\r\n\texport function format(key: LangPackKey, plain?: false, args?: FormatterArguments): ReturnType<typeof superFormatter>;\r\n\texport function format(key: LangPackKey, plain = false, args?: FormatterArguments): ReturnType<typeof superFormatter> | string {\r\n\t\tconst str = strings.get(key);\r\n\t\tlet input: string;\r\n\t\tif(str) {\r\n\t\t\tif(str._ === 'langPackStringPluralized' && args?.length) {\r\n\t\t\t\tlet v = args[0] as number | string;\r\n\t\t\t\tif(typeof(v) === 'string') v = +v.replace(/\\D/g, '');\r\n\t\t\t\tconst s = pluralRules.select(v);\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tinput = str[s + '_value'] || str['other_value'];\r\n\t\t\t} else if(str._ === 'langPackString') {\r\n\t\t\t\tinput = str.value;\r\n\t\t\t} else {\r\n\t\t\t\t//input = '[' + key + ']';\r\n\t\t\t\tinput = key;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//input = '[' + key + ']';\r\n\t\t\tinput = key;\r\n\t\t}\r\n\r\n    const result = superFormatter(input, args);\r\n    if(plain) { // * let's try a hack now... (don't want to replace []() entity)\r\n      return result.map((item) => item instanceof Node ? item.textContent : item).join('');\r\n    } else {\r\n      return result;\r\n    }\r\n\t\t\r\n\t\t/* if(plain) {\r\n\t\t\tif(args?.length) {\r\n\t\t\t\tconst regExp = /un\\d|%\\d\\$.|%./g;\r\n\t\t\t\tlet i = 0;\r\n\t\t\t\tinput = input.replace(regExp, (match, offset, string) => {\r\n\t\t\t\t\treturn '' + args[i++];\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn input;\r\n\t\t} else {\r\n\t\t\treturn superFormatter(input, args);\r\n\t\t} */\r\n\t}\r\n\r\n\texport const weakMap: WeakMap<HTMLElement, IntlElementBase<IntlElementBaseOptions>> = new WeakMap();\r\n\r\n\texport type IntlElementBaseOptions = {\r\n\t\telement?: HTMLElement,\r\n\t\tproperty?: 'innerText' | 'innerHTML' | 'placeholder' | 'textContent',\r\n\t};\r\n\r\n\tabstract class IntlElementBase<Options extends IntlElementBaseOptions> {\r\n\t\tpublic element: IntlElementBaseOptions['element'];\r\n\t\tpublic property: IntlElementBaseOptions['property'];\r\n\t\r\n\t\tconstructor(options?: Options) {\r\n\t\t\tthis.element = options?.element || document.createElement('span');\r\n\t\t\tthis.element.classList.add('i18n');\r\n\t\t\t\r\n      this.property = options?.property;\r\n      if(options && ((options as any as IntlElementOptions).key || (options as any as IntlDateElementOptions).date)) {\r\n        this.update(options);\r\n      }\r\n\r\n\t\t\tweakMap.set(this.element, this);\r\n\t\t}\r\n\r\n\t\tabstract update(options?: Options): void;\r\n\t}\r\n\r\n\texport type IntlElementOptions = IntlElementBaseOptions & {\r\n\t\tkey?: LangPackKey,\r\n\t\targs?: FormatterArguments\r\n\t};\r\n\texport class IntlElement extends IntlElementBase<IntlElementOptions> {\r\n\t\tpublic key: IntlElementOptions['key'];\r\n\t\tpublic args: IntlElementOptions['args'];\r\n\r\n    constructor(options: IntlElementOptions = {}) {\r\n      super({...options, property: options.property ?? 'innerHTML'});\r\n    }\r\n\r\n\t\tpublic update(options?: IntlElementOptions) {\r\n\t\t\tsafeAssign(this, options);\r\n\t\r\n\t\t\tif(this.property === 'innerHTML') {\r\n\t\t\t\tthis.element.textContent = '';\r\n\t\t\t\tthis.element.append(...format(this.key, false, this.args) as any);\r\n\t\t\t} else {\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tconst v = this.element[this.property];\r\n\t\t\t\tconst formatted = format(this.key, true, this.args);\r\n\r\n\t\t\t\t// * hasOwnProperty won't work here\r\n\t\t\t\tif(v === undefined) this.element.dataset[this.property] = formatted;\r\n\t\t\t\telse (this.element as HTMLInputElement)[this.property] = formatted;\r\n\t\t\t}\r\n\t\t}\r\n\r\n    public compareAndUpdate(options?: IntlElementOptions) {\r\n      if(this.key === options.key && deepEqual(this.args, options.args)) {\r\n        return;\r\n      }\r\n\r\n      return this.update(options);\r\n    }\r\n\t}\r\n\r\n  const cachedDateTimeFormats: Map<string, Intl.DateTimeFormat> = new Map();\r\n  function getDateTimeFormat(options: Intl.DateTimeFormatOptions = {}) {\r\n    const json = JSON.stringify(options);\r\n    let dateTimeFormat = cachedDateTimeFormats.get(json);\r\n    if(!dateTimeFormat) {\r\n      dateTimeFormat = new Intl.DateTimeFormat(lastRequestedNormalizedLangCode + '-u-hc-' + timeFormat, options);\r\n      cachedDateTimeFormats.set(json, dateTimeFormat);\r\n    }\r\n\r\n    return dateTimeFormat;\r\n  }\r\n\r\n  export let amPmCache = {am: 'AM', pm: 'PM'};\r\n\texport type IntlDateElementOptions = IntlElementBaseOptions & {\r\n\t\tdate?: Date,\r\n\t\toptions: Intl.DateTimeFormatOptions\r\n\t};\r\n\texport class IntlDateElement extends IntlElementBase<IntlDateElementOptions> {\r\n\t\tpublic date: IntlDateElementOptions['date'];\r\n\t\tpublic options: IntlDateElementOptions['options'];\r\n\r\n    constructor(options: IntlDateElementOptions) {\r\n      super({...options, property: options.property ?? 'textContent'});\r\n    }\r\n\r\n\t\tpublic update(options?: IntlDateElementOptions) {\r\n\t\t\tsafeAssign(this, options);\r\n\t\r\n      let text: string;\r\n      if(this.options.hour && this.options.minute && Object.keys(this.options).length === 2/*  && false */) {\r\n        let hours = this.date.getHours();\r\n        text = ('0' + (timeFormat === 'h12' ? (hours % 12) || 12 : hours)).slice(-2) + ':' + ('0' + this.date.getMinutes()).slice(-2);\r\n        // if(this.options.second) {\r\n        //   text += ':' + ('0' + this.date.getSeconds()).slice(-2);\r\n        // }\r\n\r\n        if(timeFormat === 'h12') {\r\n          text += ' ' + (hours < 12 ? amPmCache.am : amPmCache.pm);\r\n        }\r\n      } else {\r\n        // * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/Locale/hourCycle#adding_an_hour_cycle_via_the_locale_string\r\n        const dateTimeFormat = getDateTimeFormat(this.options);\r\n        text = capitalizeFirstLetter(dateTimeFormat.format(this.date));\r\n      }\r\n\r\n      (this.element as any)[this.property] = text;\r\n\t\t}\r\n\t}\r\n\r\n\texport function i18n(key: LangPackKey, args?: FormatterArguments) {\r\n\t\treturn new IntlElement({key, args}).element;\r\n\t}\r\n\t\r\n\texport function i18n_(options: IntlElementOptions) {\r\n\t\treturn new IntlElement(options).element;\r\n\t}\r\n\r\n\texport function _i18n(element: HTMLElement, key: LangPackKey, args?: FormatterArguments, property?: IntlElementOptions['property']) {\r\n\t\treturn new IntlElement({element, key, args, property}).element;\r\n\t}\r\n}\r\n\r\nexport {I18n};\r\nexport default I18n;\r\n\r\nconst i18n = I18n.i18n;\r\nexport {i18n};\r\n\r\nconst i18n_ = I18n.i18n_;\r\nexport {i18n_};\r\n\r\nconst _i18n = I18n._i18n;\r\nexport {_i18n};\r\n\r\nexport function joinElementsWith(elements: (Node | string)[], joiner: typeof elements[0] | ((isLast: boolean) => typeof elements[0])) {\r\n\tconst arr = elements.slice(0, 1);\r\n  for(let i = 1; i < elements.length; ++i) {\r\n    const isLast = (elements.length - 1) === i;\r\n    arr.push(typeof(joiner) === 'function' ? joiner(isLast) : joiner);\r\n    arr.push(elements[i]);\r\n  }\r\n\r\n\treturn arr;\r\n}\r\n\r\n\r\nexport function join(elements: (Node | string)[], useLast: boolean, plain: true): string;\r\nexport function join(elements: (Node | string)[], useLast?: boolean, plain?: false): (string | Node)[];\r\nexport function join(elements: (Node | string)[], useLast: boolean, plain: boolean): string | (string | Node)[];\r\nexport function join(elements: (Node | string)[], useLast = true, plain?: boolean): string | (string | Node)[] {\r\n\tconst joined = joinElementsWith(elements, (isLast) => {\r\n    const langPackKey: LangPackKey = isLast && useLast ? 'AutoDownloadSettings.LastDelimeter' : 'AutoDownloadSettings.Delimeter';\r\n    return plain ? I18n.format(langPackKey, true) : i18n(langPackKey);\r\n  });\r\n\r\n  return plain ? joined.join('') : joined;\r\n}\r\n\r\nMOUNT_CLASS_TO.I18n = I18n;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n\r\n/**\r\n * Legacy Webogram's format, don't change dcID to camelCase. date is timestamp\r\n */\r\nexport type UserAuth = {dcID: number | string, date: number, id: PeerId};\r\n\r\nexport const NULL_PEER_ID: PeerId = 0;\r\nexport const REPLIES_PEER_ID: PeerId = 1271266957;\r\nexport const REPLIES_HIDDEN_CHANNEL_ID: ChatId = 777;\r\nexport const SERVICE_PEER_ID: PeerId = 777000;\r\nexport const MUTE_UNTIL = 0x7FFFFFFF;\r\nexport const BOT_START_PARAM = '';\r\n","import { IS_APPLE_MOBILE, IS_SAFARI } from \"./userAgent\";\r\n\r\nconst IS_WEBM_SUPPORTED = !!document.createElement('video').canPlayType('video/webm') && !IS_SAFARI && !IS_APPLE_MOBILE;\r\n\r\nexport default IS_WEBM_SUPPORTED;\r\n","import IS_CALL_SUPPORTED from \"./callSupport\";\r\nimport CAN_USE_TRANSFERABLES from \"./canUseTransferables\";\r\nimport IS_CANVAS_FILTER_SUPPORTED from \"./canvasFilterSupport\";\r\nimport IS_EMOJI_SUPPORTED from \"./emojiSupport\";\r\nimport IS_GEOLOCATION_SUPPORTED from \"./geolocationSupport\";\r\nimport IS_GROUP_CALL_SUPPORTED from \"./groupCallSupport\";\r\nimport IMAGE_MIME_TYPES_SUPPORTED from \"./imageMimeTypesSupport\";\r\nimport MEDIA_MIME_TYPES_SUPPORTED from \"./mediaMimeTypesSupport\";\r\nimport IS_MOV_SUPPORTED from \"./movSupport\";\r\nimport IS_PARALLAX_SUPPORTED from \"./parallaxSupport\";\r\nimport IS_SCREEN_SHARING_SUPPORTED from \"./screenSharingSupport\";\r\nimport IS_TOUCH_SUPPORTED from \"./touchSupport\";\r\nimport IS_VIBRATE_SUPPORTED from \"./vibrateSupport\";\r\nimport VIDEO_MIME_TYPES_SUPPORTED from \"./videoMimeTypesSupport\";\r\nimport IS_WEBM_SUPPORTED from \"./webmSupport\";\r\nimport IS_WEBP_SUPPORTED from \"./webpSupport\";\r\nimport IS_WEBRTC_SUPPORTED from \"./webrtcSupport\";\r\nimport * as userAgent from \"./userAgent\";\r\nimport IS_OPUS_SUPPORTED from \"./opusSupport\";\r\nimport IS_SHARED_WORKER_SUPPORTED from \"./sharedWorkerSupport\";\r\nimport IS_APPLE_MX from \"./appleMx\";\r\n\r\nconst ENVIRONMENT = {\r\n  CAN_USE_TRANSFERABLES,\r\n  IS_APPLE_MX,\r\n  IS_CALL_SUPPORTED,\r\n  IS_CANVAS_FILTER_SUPPORTED,\r\n  IS_EMOJI_SUPPORTED,\r\n  IS_GEOLOCATION_SUPPORTED,\r\n  IS_GROUP_CALL_SUPPORTED,\r\n  IS_MOV_SUPPORTED,\r\n  IS_PARALLAX_SUPPORTED,\r\n  IS_SCREEN_SHARING_SUPPORTED,\r\n  IS_TOUCH_SUPPORTED,\r\n  IS_VIBRATE_SUPPORTED,\r\n  IS_OPUS_SUPPORTED,\r\n  IS_SHARED_WORKER_SUPPORTED,\r\n  IS_WEBM_SUPPORTED,\r\n  IS_WEBP_SUPPORTED,\r\n  IS_WEBRTC_SUPPORTED,\r\n  IMAGE_MIME_TYPES_SUPPORTED,\r\n  MEDIA_MIME_TYPES_SUPPORTED,\r\n  VIDEO_MIME_TYPES_SUPPORTED,\r\n  ...userAgent\r\n};\r\n\r\nexport default ENVIRONMENT;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport App from \"../../../../config/app\";\r\nimport DEBUG from \"../../../../config/debug\";\r\nimport { AutoDownloadPeerTypeSettings, State, STATE_INIT } from \"../../../../config/state\";\r\nimport compareVersion from \"../../../../helpers/compareVersion\";\r\nimport copy from \"../../../../helpers/object/copy\";\r\nimport validateInitObject from \"../../../../helpers/object/validateInitObject\";\r\nimport { UserAuth } from \"../../../mtproto/mtproto_config\";\r\nimport rootScope from \"../../../rootScope\";\r\nimport stateStorage from \"../../../stateStorage\";\r\nimport sessionStorage from \"../../../sessionStorage\";\r\nimport { recordPromiseBound } from \"../../../../helpers/recordPromise\";\r\n// import RESET_STORAGES_PROMISE from \"../storages/resetStoragesPromise\";\r\nimport { StoragesResults } from \"../storages/loadStorages\";\r\nimport { logger } from \"../../../logger\";\r\n\r\nconst REFRESH_EVERY = 24 * 60 * 60 * 1000; // 1 day\r\n// const REFRESH_EVERY = 1e3;\r\n//const REFRESH_EVERY_WEEK = 24 * 60 * 60 * 1000 * 7; // 7 days\r\n\r\nconst STATE_VERSION = STATE_INIT.version;\r\nconst BUILD = STATE_INIT.build;\r\n\r\nconst ALL_KEYS = Object.keys(STATE_INIT) as any as Array<keyof State>;\r\n\r\nconst REFRESH_KEYS: Array<keyof State> = [\r\n  'contactsListCachedTime', \r\n  'stateCreatedTime',\r\n  'maxSeenMsgId', \r\n  'filters'\r\n];\r\n\r\n//const REFRESH_KEYS_WEEK = ['dialogs', 'allDialogsLoaded', 'updates', 'pinnedOrders'] as any as Array<keyof State>;\r\n\r\nasync function loadStateInner() {\r\n  const log = logger('STATE-LOADER');\r\n\r\n  const totalPerf = performance.now();\r\n  const recordPromise = recordPromiseBound(log);\r\n\r\n  const promises = ALL_KEYS.map((key) => recordPromise(stateStorage.get(key), 'state ' + key))\r\n  .concat(\r\n    recordPromise(sessionStorage.get('user_auth'), 'auth'), \r\n    recordPromise(sessionStorage.get('state_id'), 'auth'),\r\n    recordPromise(sessionStorage.get('k_build'), 'auth')\r\n  )\r\n  .concat(recordPromise(stateStorage.get('user_auth'), 'old auth')); // support old webk format\r\n\r\n  const arr = await Promise.all(promises);\r\n  log.warn('promises', performance.now() - totalPerf);\r\n  // await new Promise((resolve) => setTimeout(resolve, 3e3));\r\n  /* const self = this;\r\n  const skipHandleKeys = new Set(['isProxy', 'filters', 'drafts']);\r\n  const getHandler = (path?: string) => {\r\n    return {\r\n      get(target: any, key: any) {\r\n        if(key === 'isProxy') {\r\n          return true;\r\n        }\r\n\r\n        const prop = target[key];\r\n\r\n        if(prop !== undefined && !skipHandleKeys.has(key) && !prop.isProxy && typeof(prop) === 'object') {\r\n          target[key] = new Proxy(prop, getHandler(path || key));\r\n          return target[key];\r\n        }\r\n        \r\n        return prop;\r\n      },\r\n      set(target: any, key: any, value: any) {\r\n        console.log('Setting', target, `.${key} to equal`, value, path);\r\n    \r\n        target[key] = value;\r\n\r\n        // @ts-ignore\r\n        self.pushToState(path || key, path ? self.state[path] : value, false);\r\n\r\n        return true;\r\n      }\r\n    };\r\n  }; */\r\n\r\n  // const pushed: {key: keyof State, value: State[keyof State]}[] = [];\r\n  const pushedKeys: (keyof State)[] = [];\r\n  const pushToState = <T extends keyof State>(key: T, value: State[T]) => {\r\n    // appStateManager.pushToState(key, value);\r\n    state[key] = value;\r\n    // pushed.push({key, value});\r\n    pushedKeys.push(key);\r\n  };\r\n\r\n  const replaceState = (_state: State) => {\r\n    // pushed.length = 0;\r\n    pushedKeys.length = 0;\r\n    state = _state;\r\n    pushedKeys.push(...Object.keys(state) as any as typeof pushedKeys);\r\n    // state = appStateManager.setState(_state);\r\n    // appStateManager.storage.set(state);\r\n  };\r\n\r\n  // let state: State = appStateManager.setState({} as any);\r\n  let state: State = {} as any;\r\n\r\n  // ! then can't store false values\r\n  for(let i = 0, length = ALL_KEYS.length; i < length; ++i) {\r\n    const key = ALL_KEYS[i];\r\n    const value = arr[i];\r\n    if(value !== undefined) {\r\n      // @ts-ignore\r\n      state[key] = value;\r\n    } else {\r\n      pushToState(key, copy(STATE_INIT[key]));\r\n    }\r\n  }\r\n\r\n  arr.splice(0, ALL_KEYS.length);\r\n\r\n  // * Read auth\r\n  let auth = arr.shift() as UserAuth | number;\r\n  const stateId = arr.shift() as number;\r\n  const sessionBuild = arr.shift() as number;\r\n  const shiftedWebKAuth = arr.shift() as UserAuth | number;\r\n  if(!auth && shiftedWebKAuth) { // support old webk auth\r\n    auth = shiftedWebKAuth;\r\n    const keys: string[] = ['dc', 'server_time_offset', 'xt_instance'];\r\n    for(let i = 1; i <= 5; ++i) {\r\n      keys.push(`dc${i}_server_salt`);\r\n      keys.push(`dc${i}_auth_key`);\r\n    }\r\n\r\n    const values = await Promise.all(keys.map((key) => stateStorage.get(key as any)));\r\n    keys.push('user_auth');\r\n    values.push(typeof(auth) === 'number' || typeof(auth) === 'string' ? {dcID: values[0] || App.baseDcId, date: Date.now() / 1000 | 0, id: auth.toPeerId(false)} as UserAuth : auth);\r\n\r\n    let obj: any = {};\r\n    keys.forEach((key, idx) => {\r\n      obj[key] = values[idx];\r\n    });\r\n\r\n    await sessionStorage.set(obj);\r\n  }\r\n  \r\n  /* if(!auth) { // try to read Webogram's session from localStorage\r\n    try {\r\n      const keys = Object.keys(localStorage);\r\n      for(let i = 0; i < keys.length; ++i) {\r\n        const key = keys[i];\r\n        let value: any;\r\n        try {\r\n          value = localStorage.getItem(key);\r\n          value = JSON.parse(value);\r\n        } catch(err) {\r\n          //console.error(err);\r\n        }\r\n\r\n        sessionStorage.set({\r\n          [key as any]: value\r\n        });\r\n      }\r\n\r\n      auth = sessionStorage.getFromCache('user_auth');\r\n    } catch(err) {\r\n      this.log.error('localStorage import error', err);\r\n    }\r\n  } */\r\n\r\n  if(auth) {\r\n    // ! Warning ! DON'T delete this\r\n    state.authState = {_: 'authStateSignedIn'};\r\n    rootScope.dispatchEvent('user_auth', typeof(auth) === 'number' || typeof(auth) === 'string' ? \r\n      {dcID: 0, date: Date.now() / 1000 | 0, id: auth.toPeerId(false)} : \r\n      auth); // * support old version\r\n  }\r\n\r\n  const resetStorages: Set<keyof StoragesResults> = new Set();\r\n  if(state.stateId !== stateId) {\r\n    if(stateId !== undefined) {\r\n      const preserve: Map<keyof State, State[keyof State]> = new Map([\r\n        ['authState', undefined],\r\n        ['stateId', undefined]\r\n      ]);\r\n\r\n      preserve.forEach((_, key) => {\r\n        preserve.set(key, copy(state[key]));\r\n      });\r\n\r\n      state = copy(STATE_INIT);\r\n\r\n      preserve.forEach((value, key) => {\r\n        // @ts-ignore\r\n        state[key] = value;\r\n      });\r\n\r\n      const r: {[k in keyof StoragesResults]: number} = {\r\n        chats: 1,\r\n        dialogs: 1,\r\n        users: 1\r\n      };\r\n      for(const key in r) {\r\n        resetStorages.add(key as keyof StoragesResults);\r\n        // this.storagesResults[key as keyof AppStateManager['storagesResults']].length = 0;\r\n      }\r\n\r\n      replaceState(state);\r\n    }\r\n\r\n    await sessionStorage.set({\r\n      state_id: state.stateId\r\n    });\r\n  }\r\n\r\n  const time = Date.now();\r\n  if((state.stateCreatedTime + REFRESH_EVERY) < time) {\r\n    if(DEBUG) {\r\n      log('will refresh state', state.stateCreatedTime, time);\r\n    }\r\n\r\n    const r = (keys: typeof REFRESH_KEYS) => {\r\n      keys.forEach((key) => {\r\n        pushToState(key, copy(STATE_INIT[key]));\r\n\r\n        // const s = appStateManager.storagesResults[key as keyof AppStateManager['storagesResults']];\r\n        // if(s?.length) {\r\n          // appStateManager.resetStorages.add(key as keyof AppStateManager['storagesResults']);\r\n          // s.length = 0;\r\n        // }\r\n      });\r\n    };\r\n    \r\n    r(REFRESH_KEYS);\r\n\r\n    /* if((state.stateCreatedTime + REFRESH_EVERY_WEEK) < time) {\r\n      if(DEBUG) {\r\n        this.log('will refresh updates');\r\n      }\r\n\r\n      r(REFRESH_KEYS_WEEK);\r\n    } */\r\n  }\r\n  \r\n  //state = this.state = new Proxy(state, getHandler());\r\n\r\n  // * support old version\r\n  if(!state.settings.hasOwnProperty('theme') && state.settings.hasOwnProperty('nightTheme')) {\r\n    state.settings.theme = state.settings.nightTheme ? 'night' : 'day';\r\n    pushToState('settings', state.settings);\r\n  }\r\n\r\n  // * support old version\r\n  if(!state.settings.hasOwnProperty('themes') && state.settings.background) {\r\n    state.settings.themes = copy(STATE_INIT.settings.themes);\r\n    const theme = state.settings.themes.find((t) => t.name === state.settings.theme);\r\n    if(theme) {\r\n      theme.background = state.settings.background;\r\n      pushToState('settings', state.settings);\r\n    }\r\n  }\r\n\r\n  // * migrate auto download settings\r\n  const autoDownloadSettings = state.settings.autoDownload;\r\n  if(autoDownloadSettings?.private !== undefined) {\r\n    const oldTypes = [\r\n      'contacts' as const, \r\n      'private' as const, \r\n      'groups' as const, \r\n      'channels' as const\r\n    ];\r\n\r\n    const mediaTypes = [\r\n      'photo' as const,\r\n      'video' as const,\r\n      'file' as const\r\n    ];\r\n\r\n    mediaTypes.forEach((mediaType) => {\r\n      const peerTypeSettings: AutoDownloadPeerTypeSettings = autoDownloadSettings[mediaType] = {} as any;\r\n      oldTypes.forEach((peerType) => {\r\n        peerTypeSettings[peerType] = autoDownloadSettings[peerType];\r\n      });\r\n    });\r\n\r\n    oldTypes.forEach((peerType) => {\r\n      delete autoDownloadSettings[peerType];\r\n    });\r\n\r\n    pushToState('settings', state.settings);\r\n  }\r\n\r\n  validateInitObject(STATE_INIT, state, (missingKey) => {\r\n    pushToState(missingKey as keyof State, state[missingKey as keyof State]);\r\n  });\r\n\r\n  let newVersion: string, oldVersion: string;\r\n  if(state.version !== STATE_VERSION || state.build !== BUILD/*  || true */) {\r\n    // reset filters and dialogs if version is older\r\n    if(compareVersion(state.version, '0.8.7') === -1 || state.build < 179) {\r\n      state.allDialogsLoaded = copy(STATE_INIT.allDialogsLoaded);\r\n      state.filters = copy(STATE_INIT.filters);\r\n\r\n      resetStorages.add('dialogs');\r\n    }\r\n\r\n    // * migrate backgrounds (March 13, 2022; to version 1.3.0)\r\n    if(compareVersion(state.version, '1.3.0') === -1) {\r\n      let migrated = false;\r\n      state.settings.themes.forEach((theme, idx, arr) => {\r\n        if((\r\n          theme.name === 'day' && \r\n          theme.background.slug === 'ByxGo2lrMFAIAAAAmkJxZabh8eM' && \r\n          theme.background.type === 'image' \r\n        ) || (\r\n          theme.name === 'night' && \r\n          theme.background.color === '#0f0f0f' && \r\n          theme.background.type === 'color' \r\n        )) {\r\n          const newTheme = STATE_INIT.settings.themes.find((newTheme) => newTheme.name === theme.name);\r\n          if(newTheme) {\r\n            arr[idx] = copy(newTheme);\r\n            migrated = true;\r\n          }\r\n        }\r\n      });\r\n\r\n      if(migrated) {\r\n        pushToState('settings', state.settings);\r\n      }\r\n    }\r\n    \r\n    if(compareVersion(state.version, STATE_VERSION) !== 0) {\r\n      newVersion = STATE_VERSION;\r\n      oldVersion = state.version;\r\n    }\r\n\r\n    pushToState('version', STATE_VERSION);\r\n    pushToState('build', BUILD);\r\n  }\r\n\r\n  if(sessionBuild !== BUILD && (!sessionBuild || sessionBuild < BUILD)) {\r\n    sessionStorage.set({k_build: BUILD});\r\n  }\r\n\r\n  // ! probably there is better place for it\r\n  rootScope.settings = state.settings;\r\n\r\n  if(DEBUG) {\r\n    log('state res', state, copy(state));\r\n  }\r\n  \r\n  //return resolve();\r\n\r\n  log.warn('total', performance.now() - totalPerf);\r\n\r\n  // RESET_STORAGES_PROMISE.resolve(appStateManager.resetStorages);\r\n\r\n  return {state, resetStorages, newVersion, oldVersion, pushedKeys};\r\n}\r\n\r\nlet promise: ReturnType<typeof loadStateInner>;\r\nexport default function loadState() {\r\n  return promise ??= loadStateInner();\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type { RequestFilePartTask, RequestFilePartTaskResponse, ServiceWorkerTask } from '../serviceWorker/index.service';\nimport type { Awaited, WorkerTaskVoidTemplate } from '../../types';\nimport type { CacheStorageDbName } from '../cacheStorage';\nimport type { State } from '../../config/state';\nimport type { Message, MessagePeerReaction, PeerNotifySettings } from '../../layer';\nimport { CryptoMethods } from '../crypto/crypto_methods';\nimport rootScope from '../rootScope';\nimport webpWorkerController from '../webp/webpWorkerController';\nimport { MOUNT_CLASS_TO } from '../../config/debug';\nimport sessionStorage from '../sessionStorage';\nimport webPushApiManager from './webPushApiManager';\nimport appRuntimeManager from '../appManagers/appRuntimeManager';\nimport telegramMeWebManager from './telegramMeWebManager';\nimport pause from '../../helpers/schedulers/pause';\nimport isObject from '../../helpers/object/isObject';\nimport ENVIRONMENT from '../../environment';\nimport loadState from '../appManagers/utils/state/loadState';\nimport opusDecodeController from '../opusDecodeController';\nimport MTProtoMessagePort from './mtprotoMessagePort';\nimport cryptoMessagePort from '../crypto/cryptoMessagePort';\nimport SuperMessagePort from './superMessagePort';\nimport IS_SHARED_WORKER_SUPPORTED from '../../environment/sharedWorkerSupport';\nimport toggleStorages from '../../helpers/toggleStorages';\nimport idleController from '../../helpers/idleController';\n\nexport interface ToggleStorageTask extends WorkerTaskVoidTemplate {\n  type: 'toggleStorages',\n  payload: {enabled: boolean, clearWrite: boolean}\n};\n\nexport type Mirrors = {\n  state: State\n};\n\nexport type MirrorTaskPayload<T extends keyof Mirrors = keyof Mirrors, K extends keyof Mirrors[T] = keyof Mirrors[T], J extends Mirrors[T][K] = Mirrors[T][K]> = {\n  name: T, \n  key?: K, \n  value: any\n};\n\nexport type NotificationBuildTaskPayload = {\n  message: Message.message | Message.messageService,\n  fwdCount?: number,\n  peerReaction?: MessagePeerReaction,\n  peerTypeNotifySettings?: PeerNotifySettings\n};\n\nexport type TabState = {\n  chatPeerIds: PeerId[],\n  idleStartTime: number,\n};\n\nclass ApiManagerProxy extends MTProtoMessagePort {\n  private worker: /* Window */Worker;\n  private isSWRegistered: boolean;\n  // private sockets: Map<number, Socket> = new Map();\n  private taskListenersSW: {[taskType: string]: (task: any) => void};\n  private mirrors: Mirrors;\n\n  public newVersion: string;\n  public oldVersion: string;\n\n  private tabState: TabState;\n\n  constructor() {\n    super();\n\n    this.isSWRegistered = true;\n    this.taskListenersSW = {};\n    this.mirrors = {} as any;\n    this.tabState = {\n      chatPeerIds: [],\n      idleStartTime: 0\n    };\n\n    this.log('constructor');\n\n                       \n    this.registerWorker();\n              \n\n    this.registerServiceWorker();\n    this.registerCryptoWorker();\n\n    this.addMultipleEventsListeners({\n      convertWebp: ({fileName, bytes}) => {\n        return webpWorkerController.convert(fileName, bytes);\n      },\n\n      convertOpus: ({fileName, bytes}) => {\n        return opusDecodeController.pushDecodeTask(bytes, false).then((result) => result.bytes);\n      },\n\n      event: ({name, args}) => {\n        // @ts-ignore\n        rootScope.dispatchEventSingle(name, ...args);\n      },\n\n      localStorageProxy: (payload) => {\n        const storageTask = payload;\n        return (sessionStorage[storageTask.type] as any)(...storageTask.args);\n      },\n      \n      mirror: this.onMirrorTask\n    });\n\n    // this.addTaskListener('socketProxy', (task) => {\n    //   const socketTask = task.payload;\n    //   const id = socketTask.id;\n    //   //console.log('socketProxy', socketTask, id);\n\n    //   if(socketTask.type === 'send') {\n    //     const socket = this.sockets.get(id);\n    //     socket.send(socketTask.payload);\n    //   } else if(socketTask.type === 'close') { // will remove from map in onClose\n    //     const socket = this.sockets.get(id);\n    //     socket.close();\n    //   } else if(socketTask.type === 'setup') {\n    //     const socket = new Socket(socketTask.payload.dcId, socketTask.payload.url, socketTask.payload.logSuffix);\n        \n    //     const onOpen = () => {\n    //       //console.log('socketProxy onOpen');\n    //       this.postMessage({\n    //         type: 'socketProxy', \n    //         payload: {\n    //           type: 'open',\n    //           id\n    //         }\n    //       });\n    //     };\n    //     const onClose = () => {\n    //       this.postMessage({\n    //         type: 'socketProxy', \n    //         payload: {\n    //           type: 'close',\n    //           id\n    //         }\n    //       });\n\n    //       socket.removeEventListener('open', onOpen);\n    //       socket.removeEventListener('close', onClose);\n    //       socket.removeEventListener('message', onMessage);\n    //       this.sockets.delete(id);\n    //     };\n    //     const onMessage = (buffer: ArrayBuffer) => {\n    //       this.postMessage({\n    //         type: 'socketProxy', \n    //         payload: {\n    //           type: 'message',\n    //           id,\n    //           payload: buffer\n    //         }\n    //       });\n    //     };\n\n    //     socket.addEventListener('open', onOpen);\n    //     socket.addEventListener('close', onClose);\n    //     socket.addEventListener('message', onMessage);\n    //     this.sockets.set(id, socket);\n    //   }\n    // });\n\n    rootScope.addEventListener('language_change', (language) => {\n      rootScope.managers.networkerFactory.setLanguage(language);\n    });\n\n    window.addEventListener('online', () => {\n      rootScope.managers.networkerFactory.forceReconnectTimeout();\n    });\n\n    rootScope.addEventListener('logging_out', () => {\n      const toClear: CacheStorageDbName[] = ['cachedFiles', 'cachedStreamChunks'];\n      Promise.all([\n        toggleStorages(false, true), \n        sessionStorage.clear(),\n        Promise.race([\n          telegramMeWebManager.setAuthorized(false),\n          pause(3000)\n        ]),\n        webPushApiManager.forceUnsubscribe(),\n        Promise.all(toClear.map((cacheName) => caches.delete(cacheName)))\n      ]).finally(() => {\n        appRuntimeManager.reload();\n      });\n    });\n\n    idleController.addEventListener('change', (idle) => {\n      this.updateTabStateIdle(idle);\n    });\n    this.updateTabStateIdle(idleController.isIdle);\n\n    this.log('Passing environment:', ENVIRONMENT);\n    this.invoke('environment', ENVIRONMENT);\n    // this.sendState();\n  }\n\n  private registerServiceWorker() {\n    if(!('serviceWorker' in navigator)) return;\n    \n    // ! I hate webpack - it won't load it by using worker.register, only navigator.serviceWork will do it.\n    const worker = navigator.serviceWorker;\n    navigator.serviceWorker.register(\n      /* webpackChunkName: \"sw\" */\n      new URL('../serviceWorker/index.service', import.meta.url), \n      {scope: './'}\n    ).then((registration) => {\n      this.log('SW registered', registration);\n      this.isSWRegistered = true;\n\n      const sw = registration.installing || registration.waiting || registration.active;\n      sw.addEventListener('statechange', (e) => {\n        this.log('SW statechange', e);\n      });\n\n      //this.postSWMessage = worker.controller.postMessage.bind(worker.controller);\n\n                        \n                                                                                                                     \n                                            \n                \n    }, (err) => {\n      this.isSWRegistered = false;\n      this.log.error('SW registration failed!', err);\n\n      this.invokeVoid('serviceWorkerOnline', false);\n    });\n\n    worker.addEventListener('controllerchange', () => {\n      this.log.warn('controllerchange');\n\n      worker.controller.addEventListener('error', (e) => {\n        this.log.error('controller error:', e);\n      });\n    });\n\n                      \n                                  \n                \n             \n    worker.addEventListener('message', (e) => {\n      const task: ServiceWorkerTask = e.data;\n      if(!isObject(task)) {\n        return;\n      }\n\n      const callback = this.taskListenersSW[task.type];\n      if(callback) {\n        callback(task);\n      }\n    });\n\n    this.addServiceWorkerTaskListener('requestFilePart', (task: RequestFilePartTask) => {\n      const responseTask: RequestFilePartTaskResponse = {\n        type: task.type,\n        id: task.id\n      };\n\n      const {docId, dcId, offset, limit} = task.payload;\n      rootScope.managers.appDocsManager.requestDocPart(docId, dcId, offset, limit)\n      .then((uploadFile) => {\n        responseTask.payload = uploadFile;\n        this.postSWMessage(responseTask);\n      }, (err) => {\n        responseTask.originalPayload = task.payload;\n        responseTask.error = err;\n        this.postSWMessage(responseTask);\n      });\n    });\n              \n\n    worker.addEventListener('messageerror', (e) => {\n      this.log.error('SW messageerror:', e);\n    });\n  }\n\n  private registerCryptoWorker() {\n    let worker: SharedWorker | Worker;\n    if(IS_SHARED_WORKER_SUPPORTED) {\n      worker = new SharedWorker(\n        /* webpackChunkName: \"crypto.worker\" */\n        new URL('../crypto/crypto.worker.ts', import.meta.url), \n        {type: 'module'}\n      );\n    } else {\n      worker = new Worker(\n        /* webpackChunkName: \"crypto.worker\" */\n        new URL('../crypto/crypto.worker.ts', import.meta.url), \n        {type: 'module'}\n      );\n    }\n\n    cryptoMessagePort.addEventListener('port', (payload, source, event) => {\n      this.invokeVoid('cryptoPort', undefined, undefined, [event.ports[0]]);\n    });\n\n    this.attachWorkerToPort(worker, cryptoMessagePort, 'crypto');\n  }\n\n                     \n  private registerWorker() {\n    // return;\n\n    let worker: SharedWorker | Worker;\n    if(IS_SHARED_WORKER_SUPPORTED) {\n      worker = new SharedWorker(\n        /* webpackChunkName: \"mtproto.worker\" */\n        new URL('./mtproto.worker.ts', import.meta.url), \n        {type: 'module'}\n      );\n    } else {\n      worker = new Worker(\n        /* webpackChunkName: \"mtproto.worker\" */\n        new URL('./mtproto.worker.ts', import.meta.url), \n        {type: 'module'}\n      );\n    }\n\n    this.onWorkerFirstMessage(worker);\n  }\n            \n\n  private attachWorkerToPort(worker: SharedWorker | Worker, messagePort: SuperMessagePort<any, any, any>, type: string) {\n    const port: MessagePort = (worker as SharedWorker).port || worker as any;\n    messagePort.attachPort(port);\n\n    worker.addEventListener('error', (err) => {\n      this.log.error(type, 'worker error', err);\n    });\n  }\n\n  public postSWMessage(message: any) {\n    if(navigator.serviceWorker.controller) {\n      navigator.serviceWorker.controller.postMessage(message);\n    }\n  }\n\n  private onWorkerFirstMessage(worker: any) {\n    this.log('set webWorker');\n    \n    this.worker = worker;\n                      \n                                \n             \n    this.attachWorkerToPort(worker, this, 'mtproto');\n              \n  }\n\n  public addServiceWorkerTaskListener(name: keyof ApiManagerProxy['taskListenersSW'], callback: ApiManagerProxy['taskListenersSW'][typeof name]) {\n    this.taskListenersSW[name] = callback;\n  }\n\n  private loadState() {\n    return Promise.all([\n      loadState().then((stateResult) => {\n        this.newVersion = stateResult.newVersion;\n        this.oldVersion = stateResult.oldVersion;\n        this.mirrors['state'] = stateResult.state;\n        return stateResult;\n      }),\n      // loadStorages(createStorages()),\n    ]);\n  }\n\n  public sendState() {\n    return this.loadState().then((result) => {\n      const [stateResult] = result;\n      this.invoke('state', {...stateResult, userId: rootScope.myId.toUserId()});\n      return result;\n    });\n  }\n\n                        \n  public invokeCrypto<Method extends keyof CryptoMethods>(method: Method, ...args: Parameters<CryptoMethods[typeof method]>): Promise<Awaited<ReturnType<CryptoMethods[typeof method]>>> {\n    return cryptoMessagePort.invokeCrypto(method, ...args);\n  }\n            \n\n  public async toggleStorages(enabled: boolean, clearWrite: boolean) {\n    await toggleStorages(enabled, clearWrite);\n    this.invoke('toggleStorages', {enabled, clearWrite});\n    const task: ToggleStorageTask = {type: 'toggleStorages', payload: {enabled, clearWrite}};\n    this.postSWMessage(task);\n  }\n\n  public async getMirror<T extends keyof Mirrors>(name: T) {\n    const mirror = this.mirrors[name];\n    return mirror;\n  }\n\n  public getState() {\n    return this.getMirror('state');\n  }\n\n  public updateTabState<T extends keyof TabState>(key: T, value: TabState[T]) {\n    this.tabState[key] = value;\n    this.invokeVoid('tabState', this.tabState);\n  }\n\n  public updateTabStateIdle(idle: boolean) {\n    this.updateTabState('idleStartTime', idle ? Date.now() : 0);\n  }\n\n  private onMirrorTask = (payload: MirrorTaskPayload) => {\n    const {name, key, value} = payload;\n    if(!payload.hasOwnProperty('key')) {\n      this.mirrors[name] = value;\n      return;\n    }\n    \n    const mirror = this.mirrors[name] ??= {} as any;\n    if(value === undefined) {\n      delete mirror[key];\n    } else {\n      mirror[key] = value;\n    }\n  };\n}\n\ninterface ApiManagerProxy extends MTProtoMessagePort<true> {}\n\nconst apiManagerProxy = new ApiManagerProxy();\nMOUNT_CLASS_TO.apiManagerProxy = apiManagerProxy;\nexport default apiManagerProxy;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport App from \"../../config/app\";\r\nimport { MOUNT_CLASS_TO } from \"../../config/debug\";\r\nimport tabId from \"../../config/tabId\";\r\nimport IS_SHARED_WORKER_SUPPORTED from \"../../environment/sharedWorkerSupport\";\r\nimport EventListenerBase from \"../../helpers/eventListenerBase\";\r\nimport idleController from \"../../helpers/idleController\";\r\nimport { logger } from \"../logger\";\r\nimport rootScope from \"../rootScope\";\r\nimport sessionStorage from \"../sessionStorage\";\r\nimport apiManagerProxy from \"./mtprotoworker\";\r\n\r\nexport type AppInstance = {\r\n  id: number,\r\n  idle: boolean,\r\n  time: number\r\n};\r\n\r\nexport type InstanceDeactivateReason = 'version' | 'tabs';\r\n\r\nconst CHECK_INSTANCE_INTERVAL = 5000; \r\nconst DEACTIVATE_TIMEOUT = 30000;\r\nconst MULTIPLE_TABS_THRESHOLD = 20000;\r\nconst IS_MULTIPLE_TABS_SUPPORTED = IS_SHARED_WORKER_SUPPORTED;\r\n\r\nexport class SingleInstance extends EventListenerBase<{\r\n  activated: () =>  void,\r\n  deactivated: (reason: InstanceDeactivateReason) => void\r\n}> {\r\n  private instanceId: number;\r\n  private started: boolean;\r\n  private masterInstance: boolean;\r\n  private deactivateTimeout: number;\r\n  private deactivated: InstanceDeactivateReason;\r\n  private log = logger('INSTANCE');\r\n\r\n  constructor() {\r\n    super(false);\r\n\r\n    this.log = logger('INSTANCE');\r\n    this.instanceId = tabId;\r\n  }\r\n\r\n  public get deactivatedReason() {\r\n    return this.deactivated;\r\n  }\r\n\r\n  public start() {\r\n    this.reset();\r\n\r\n    if(!this.started/*  && !Config.Navigator.mobile && !Config.Modes.packed */) {\r\n      this.started = true;\r\n\r\n      idleController.addEventListener('change', this.checkInstance);\r\n      setInterval(this.checkInstance, CHECK_INSTANCE_INTERVAL);\r\n      this.checkInstance();\r\n\r\n      try {\r\n        document.documentElement.addEventListener('beforeunload', this.clearInstance);\r\n      } catch(e) {}\r\n    }\r\n  }\r\n\r\n  private reset() {\r\n    this.masterInstance = false;\r\n    this.clearDeactivateTimeout();\r\n    this.deactivated = undefined;\r\n  }\r\n\r\n  private clearInstance = () => {\r\n    if(this.masterInstance && !this.deactivated) {\r\n      this.log.warn('clear master instance');\r\n      sessionStorage.delete('xt_instance');\r\n    }\r\n  };\r\n\r\n  public activateInstance() {\r\n    if(this.deactivated) {\r\n      this.reset();\r\n      this.checkInstance(false);\r\n      this.dispatchEvent('activated');\r\n    }\r\n  }\r\n\r\n  private deactivateInstance(reason: InstanceDeactivateReason) {\r\n    if(this.masterInstance || this.deactivated) {\r\n      return;\r\n    }\r\n\r\n    this.log.warn('deactivate', reason);\r\n    this.clearDeactivateTimeout();\r\n    this.deactivated = reason;\r\n\r\n    this.dispatchEvent('deactivated', reason);\r\n  }\r\n\r\n  private clearDeactivateTimeout() {\r\n    if(this.deactivateTimeout) {\r\n      clearTimeout(this.deactivateTimeout);\r\n      this.deactivateTimeout = 0;\r\n    }\r\n  }\r\n\r\n  private checkInstance = async(idle = idleController.isIdle) => {\r\n    if(this.deactivated) {\r\n      return;\r\n    }\r\n    \r\n    const time = Date.now();\r\n    const newInstance: AppInstance = {\r\n      id: this.instanceId, \r\n      idle, \r\n      time\r\n    };\r\n\r\n    const [curInstance, build = App.build] = await Promise.all([\r\n      sessionStorage.get('xt_instance', false),\r\n      sessionStorage.get('k_build', false)\r\n    ]);\r\n\r\n    if(build > App.build) {\r\n      this.masterInstance = false;\r\n      rootScope.managers.networkerFactory.stopAll();\r\n      this.deactivateInstance('version');\r\n      apiManagerProxy.toggleStorages(false, false);\r\n      return;\r\n    } else if(IS_MULTIPLE_TABS_SUPPORTED) {\r\n      sessionStorage.set({xt_instance: newInstance});\r\n      return;\r\n    }\r\n    \r\n    // this.log('check instance', newInstance, curInstance)\r\n    if(!idle ||\r\n        !curInstance ||\r\n        curInstance.id === this.instanceId ||\r\n        curInstance.time < (time - MULTIPLE_TABS_THRESHOLD)) {\r\n      sessionStorage.set({xt_instance: newInstance});\r\n\r\n      if(!this.masterInstance) {\r\n        this.masterInstance = true;\r\n        rootScope.managers.networkerFactory.startAll();\r\n        this.log.warn('now master instance', newInstance);\r\n      }\r\n\r\n      this.clearDeactivateTimeout();\r\n    } else if(this.masterInstance) {\r\n      this.masterInstance = false;\r\n      rootScope.managers.networkerFactory.stopAll();\r\n      this.log.warn('now idle instance', newInstance);\r\n      this.deactivateTimeout ||= window.setTimeout(() => this.deactivateInstance('tabs'), DEACTIVATE_TIMEOUT);\r\n    }\r\n  };\r\n}\r\n\r\nconst singleInstance = new SingleInstance();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.singleInstance = singleInstance);\r\nexport default singleInstance;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport App from \"../../config/app\";\r\nimport { MOUNT_CLASS_TO } from \"../../config/debug\";\r\nimport Modes from \"../../config/modes\";\r\nimport loadScript from \"../../helpers/dom/loadScript\";\r\nimport tsNow from \"../../helpers/tsNow\";\r\nimport sessionStorage from '../sessionStorage';\r\n\r\nexport class TelegramMeWebManager {\r\n  private disabled = /* false &&  */(Modes.test || App.domains.indexOf(location.hostname) === -1);\r\n\r\n  public setAuthorized(canRedirect: boolean) {\r\n    if(this.disabled) {\r\n      return;\r\n    }\r\n\r\n    return sessionStorage.get('tgme_sync').then((curValue) => {\r\n      const ts = tsNow(true);\r\n      if(\r\n        canRedirect &&\r\n        curValue?.canRedirect === canRedirect &&\r\n        (curValue.ts + 86400) > ts\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      sessionStorage.set({\r\n        tgme_sync: {\r\n          canRedirect, \r\n          ts\r\n        }\r\n      });\r\n\r\n      const path = `_websync_?authed=${canRedirect ? '1' : '0'}&version=${encodeURIComponent(App.version + ' ' + App.suffix)}`;\r\n      const urls = [\r\n        '//telegram.me/' + path,\r\n        '//t.me/' + path\r\n      ];\r\n\r\n      const promises = urls.map((url) => {\r\n        return loadScript(url).then((script) => {\r\n          script.remove();\r\n        });\r\n      });\r\n\r\n      return Promise.all(promises);\r\n    });\r\n  }\r\n}\r\n\r\nconst telegramMeWebManager = new TelegramMeWebManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.telegramMeWebManager = telegramMeWebManager);\r\nexport default telegramMeWebManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport type { ServiceWorkerNotificationsClearTask, ServiceWorkerPingTask, ServiceWorkerPushClickTask } from \"../serviceWorker/index.service\";\r\nimport { MOUNT_CLASS_TO } from \"../../config/debug\";\r\nimport { logger } from \"../logger\";\r\nimport apiManagerProxy from \"./mtprotoworker\";\r\nimport I18n, { LangPackKey } from \"../langPack\";\r\nimport { IS_MOBILE } from \"../../environment/userAgent\";\r\nimport appRuntimeManager from \"../appManagers/appRuntimeManager\";\r\nimport copy from \"../../helpers/object/copy\";\r\nimport type { NotificationSettings } from \"../appManagers/uiNotificationsManager\";\r\nimport singleInstance from \"./singleInstance\";\r\nimport EventListenerBase from \"../../helpers/eventListenerBase\";\r\nimport type { PushNotificationObject } from \"../serviceWorker/push\";\r\n\r\nexport type PushSubscriptionNotifyType = 'init' | 'subscribe' | 'unsubscribe';\r\nexport type PushSubscriptionNotifyEvent = `push_${PushSubscriptionNotifyType}`;\r\n\r\nexport type PushSubscriptionNotify = {\r\n  tokenType: number,\r\n  tokenValue: string\r\n};\r\n\r\nexport class WebPushApiManager extends EventListenerBase<{\r\n  push_notification_click: (n: PushNotificationObject) => void,\r\n  push_init: (n: PushSubscriptionNotify) => void,\r\n  push_subscribe: (n: PushSubscriptionNotify) => void,\r\n  push_unsubscribe: (n: PushSubscriptionNotify) => void\r\n}> {\r\n  public isAvailable = true;\r\n  private isPushEnabled = false;\r\n  private localNotificationsAvailable = true;\r\n  private started = false;\r\n  private settings: NotificationSettings & {baseUrl?: string} = {} as any;\r\n  private isAliveTO: any;\r\n  private isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n  private userVisibleOnly = this.isFirefox ? false : true;\r\n  private log = logger('PM');\r\n\r\n  constructor() {\r\n    super(false);\r\n\r\n    if(!('PushManager' in window) ||\r\n      !('Notification' in window) ||\r\n      !('serviceWorker' in navigator)) {\r\n      this.log.warn('Push messaging is not supported.');\r\n      this.isAvailable = false;\r\n      this.localNotificationsAvailable = false;\r\n    }\r\n\r\n    if(this.isAvailable && Notification.permission === 'denied') {\r\n      this.log.warn('The user has blocked notifications.');\r\n    }\r\n  }\r\n\r\n  public start() {\r\n    if(!this.started) {\r\n      this.started = true;\r\n      this.getSubscription();\r\n      this.setUpServiceWorkerChannel();\r\n    }\r\n  }\r\n\r\n  public setLocalNotificationsDisabled() {\r\n    this.localNotificationsAvailable = false;\r\n  }\r\n\r\n  public getSubscription() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.getSubscription().then((subscription) => {\r\n        this.isPushEnabled = !!subscription;\r\n        this.pushSubscriptionNotify('init', subscription);\r\n      }).catch((err) => {\r\n        this.log.error('Error during getSubscription()', err);\r\n      });\r\n    });\r\n  }\r\n\r\n  public subscribe = () => {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.subscribe({userVisibleOnly: this.userVisibleOnly}).then((subscription) => {\r\n        // The subscription was successful\r\n        this.isPushEnabled = true;\r\n        this.pushSubscriptionNotify('subscribe', subscription);\r\n      }).catch((e) => {\r\n        if(Notification.permission === 'denied') {\r\n          this.log('Permission for Notifications was denied');\r\n        } else {\r\n          this.log('Unable to subscribe to push.', e);\r\n          if(!this.userVisibleOnly) {\r\n            this.userVisibleOnly = true;\r\n            setTimeout(this.subscribe, 0);\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  public unsubscribe() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n    \r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.getSubscription().then((subscription) => {\r\n        this.isPushEnabled = false;\r\n\r\n        if(subscription) {\r\n          this.pushSubscriptionNotify('unsubscribe', subscription);\r\n\r\n          setTimeout(() => {\r\n            subscription.unsubscribe().then((successful) => {\r\n              this.isPushEnabled = false;\r\n            }).catch((e) => {\r\n              this.log.error('Unsubscription error: ', e);\r\n            });\r\n          }, 3000);\r\n        }\r\n      }).catch((e) => {\r\n        this.log.error('Error thrown while unsubscribing from ' +\r\n          'push messaging.', e);\r\n      });\r\n    });\r\n  }\r\n\r\n  public forceUnsubscribe() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    navigator.serviceWorker.ready.then((reg) => {\r\n      reg.pushManager.getSubscription().then((subscription) => {\r\n        this.log.warn('force unsubscribe', subscription);\r\n        if(subscription) {\r\n          subscription.unsubscribe().then((successful) => {\r\n            this.log.warn('force unsubscribe successful', successful);\r\n            this.isPushEnabled = false;\r\n          }).catch((e) => {\r\n            this.log.error('Unsubscription error: ', e);\r\n          });\r\n        }\r\n      }).catch((e) => {\r\n        this.log.error('Error thrown while unsubscribing from ' +\r\n          'push messaging.', e);\r\n      });\r\n    });\r\n  }\r\n\r\n  public isAliveNotify = () => {\r\n    if(!this.isAvailable || singleInstance.deactivatedReason) {\r\n      return;\r\n    }\r\n\r\n    this.settings.baseUrl = (location.href || '').replace(/#.*$/, '');\r\n\r\n    const lang: ServiceWorkerPingTask['payload']['lang'] = {} as any;\r\n    const ACTIONS_LANG_MAP: Record<keyof ServiceWorkerPingTask['payload']['lang'], LangPackKey> = {\r\n      push_action_mute1d: IS_MOBILE ? 'PushNotification.Action.Mute1d.Mobile' : 'PushNotification.Action.Mute1d',\r\n      push_action_settings: IS_MOBILE ? 'PushNotification.Action.Settings.Mobile' : 'PushNotification.Action.Settings',\r\n      push_message_nopreview: 'PushNotification.Message.NoPreview'\r\n    };\r\n\r\n    for(const action in ACTIONS_LANG_MAP) {\r\n      lang[action as keyof typeof ACTIONS_LANG_MAP] = I18n.format(ACTIONS_LANG_MAP[action as keyof typeof ACTIONS_LANG_MAP], true);\r\n    }\r\n\r\n    const task: ServiceWorkerPingTask = {\r\n      type: 'ping',\r\n      payload: {\r\n        localNotifications: this.localNotificationsAvailable,\r\n        lang: lang,\r\n        settings: this.settings\r\n      }\r\n    };\r\n\r\n    apiManagerProxy.postSWMessage(task);\r\n\r\n    this.isAliveTO = setTimeout(this.isAliveNotify, 10000);\r\n  }\r\n\r\n  public setSettings(newSettings: WebPushApiManager['settings']) {\r\n    this.settings = copy(newSettings);\r\n    clearTimeout(this.isAliveTO);\r\n    this.isAliveNotify();\r\n  }\r\n\r\n  public hidePushNotifications() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    const task: ServiceWorkerNotificationsClearTask = {type: 'notifications_clear'};\r\n    apiManagerProxy.postSWMessage(task);\r\n  }\r\n\r\n  public setUpServiceWorkerChannel() {\r\n    if(!this.isAvailable) {\r\n      return;\r\n    }\r\n\r\n    apiManagerProxy.addServiceWorkerTaskListener('push_click', (task: ServiceWorkerPushClickTask) => {\r\n      if(singleInstance.deactivatedReason) {\r\n        appRuntimeManager.reload();\r\n        return;\r\n      }\r\n\r\n      this.dispatchEvent('push_notification_click', task.payload);\r\n    });\r\n\r\n    navigator.serviceWorker.ready.then(this.isAliveNotify);\r\n  }\r\n\r\n  public pushSubscriptionNotify(event: PushSubscriptionNotifyType, subscription?: PushSubscription) {\r\n    if(subscription) {\r\n      const subscriptionObj: PushSubscriptionJSON = subscription.toJSON();\r\n      if(!subscriptionObj ||\r\n        !subscriptionObj.endpoint ||\r\n        !subscriptionObj.keys ||\r\n        !subscriptionObj.keys.p256dh ||\r\n        !subscriptionObj.keys.auth) {\r\n        this.log.warn('Invalid push subscription', subscriptionObj);\r\n        this.unsubscribe();\r\n        this.isAvailable = false;\r\n        this.pushSubscriptionNotify(event);\r\n        return;\r\n      }\r\n      \r\n      this.log.warn('Push', event, subscriptionObj);\r\n      this.dispatchEvent(('push_' + event) as PushSubscriptionNotifyEvent, {\r\n        tokenType: 10,\r\n        tokenValue: JSON.stringify(subscriptionObj)\r\n      });\r\n    } else {\r\n      this.log.warn('Push', event, false);\r\n      this.dispatchEvent(('push_' + event) as PushSubscriptionNotifyEvent, false as any);\r\n    }\r\n  }\r\n}\r\n\r\nconst webPushApiManager = new WebPushApiManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.webPushApiManager = webPushApiManager);\r\nexport default webPushApiManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { MOUNT_CLASS_TO } from \"../config/debug\";\r\nimport IS_OPUS_SUPPORTED from \"../environment/opusSupport\";\r\nimport { IS_SAFARI } from \"../environment/userAgent\";\r\nimport { Modify } from \"../types\";\r\nimport { logger, LogTypes } from \"./logger\";\r\nimport apiManagerProxy from \"./mtproto/mtprotoworker\";\r\nimport type { ConvertWebPTask } from \"./webp/webpWorkerController\";\r\n\r\ntype Result = {\r\n  bytes: Uint8Array, \r\n  waveform?: Uint8Array\r\n};\r\n\r\ntype Task = {\r\n  pages: Uint8Array,\r\n  withWaveform: boolean,\r\n  waveform?: Uint8Array,\r\n  callback: {resolve: (result: Result) => void, reject: (err: any) => void},\r\n  timeout: number\r\n};\r\n\r\nexport interface ConvertOpusTask extends Modify<ConvertWebPTask, {type: 'convertOpus'}> {\r\n  type: 'convertOpus'\r\n}\r\n\r\nexport class OpusDecodeController {\r\n  private worker: Worker;\r\n  private wavWorker: Worker;\r\n  private sampleRate = 48000;\r\n  private tasks: Array<Task> = [];\r\n  private keepAlive = false;\r\n  private log = logger('OPUS', LogTypes.Error);\r\n\r\n  public isPlaySupported() {\r\n    return IS_OPUS_SUPPORTED;\r\n  }\r\n\r\n  public loadWavWorker() {\r\n    if(this.wavWorker) return;\r\n\r\n    this.wavWorker = new Worker('waveWorker.min.js');\r\n    this.wavWorker.addEventListener('message', (e) => {\r\n      const data = e.data;\r\n\r\n      this.log('[WAV] got message:', data);\r\n      if(data && data.page) {\r\n        const bytes = data.page;\r\n        this.onTaskEnd(this.tasks.shift(), bytes);\r\n      }\r\n    });\r\n  }\r\n\r\n  public loadWorker() {\r\n    if(this.worker) return;\r\n\r\n    this.worker = new Worker('decoderWorker.min.js');\r\n    this.worker.addEventListener('message', (e) => {\r\n      const data = e.data;\r\n      \r\n      this.log('[DECODER] got message', data);\r\n      if(data.type === 'done') {\r\n        //this.log('[DECODER] send done to wav');\r\n        this.wavWorker.postMessage({command: 'done'});\r\n\r\n        if(data.waveform) {\r\n          this.tasks[0].waveform = data.waveform;\r\n        }\r\n      } else { // e.data contains decoded buffers as float32 values\r\n        //this.log('[DECODER] send encode to wav');\r\n        this.wavWorker.postMessage({\r\n          command: 'encode',\r\n          buffers: e.data\r\n        }, IS_SAFARI ? undefined : data.map((typedArray: Uint8Array) => typedArray.buffer));\r\n      }\r\n    });\r\n  }\r\n\r\n  public setKeepAlive(keepAlive: boolean) {\r\n    this.keepAlive = keepAlive;\r\n    if(this.keepAlive) {\r\n      this.loadWorker();\r\n      this.loadWavWorker();\r\n    } else if(!this.tasks.length) {\r\n      this.terminateWorkers();\r\n    }\r\n  }\r\n\r\n  public onTaskEnd(task: Task, result?: Uint8Array) {\r\n    if(!result) {\r\n      task.callback.reject('timeout');\r\n    } else {\r\n      clearTimeout(task.timeout);\r\n      task.callback.resolve({bytes: result, waveform: task.waveform});\r\n    }\r\n\r\n    if(this.tasks.length) {\r\n      this.executeNewTask(this.tasks[0]);\r\n    }\r\n\r\n    this.terminateWorkers();\r\n  }\r\n\r\n  public terminateWorkers(kill = false) {\r\n    if((this.keepAlive || this.tasks.length) && !kill) return;\r\n\r\n    if(this.worker) {\r\n      this.worker.terminate();\r\n      this.worker = null;\r\n    }\r\n    \r\n    if(this.wavWorker) {\r\n      this.wavWorker.terminate();\r\n      this.wavWorker = null;\r\n    }\r\n  }\r\n\r\n  public executeNewTask(task: Task) {\r\n    this.worker.postMessage({ \r\n      command: 'init',\r\n      decoderSampleRate: this.sampleRate,\r\n      outputBufferSampleRate: this.sampleRate\r\n    });\r\n\r\n    this.wavWorker.postMessage({ \r\n      command: 'init',\r\n      wavBitDepth: 16,\r\n      wavSampleRate: this.sampleRate\r\n    });\r\n\r\n    //console.log('sending command to worker:', task);\r\n    //setTimeout(() => {\r\n      this.log('[DECODER] send decode');\r\n      this.worker.postMessage({\r\n        command: 'decode',\r\n        pages: task.pages,\r\n        waveform: task.withWaveform\r\n      }, IS_SAFARI ? undefined : [task.pages.buffer]);\r\n    //}, 1e3);\r\n\r\n    task.timeout = window.setTimeout(() => {\r\n      this.log.error('decode timeout'/* , task */);\r\n\r\n      this.terminateWorkers(true);\r\n      if(this.tasks.length) {\r\n        this.loadWorker();\r\n        this.loadWavWorker();\r\n      }\r\n\r\n      this.onTaskEnd(this.tasks.shift());\r\n    }, 10e3);\r\n  }\r\n\r\n  public pushDecodeTask(pages: Uint8Array, withWaveform: boolean) {\r\n    return new Promise<Result>((resolve, reject) => {\r\n      const task = {\r\n        pages,\r\n        withWaveform,\r\n        callback: {resolve, reject},\r\n        timeout: 0\r\n      };\r\n\r\n      this.loadWorker();\r\n      this.loadWavWorker();\r\n\r\n      if(this.tasks.push(task) === 1) {\r\n        this.executeNewTask(task);\r\n      }\r\n    });\r\n  }\r\n\r\n  public async decode(typedArray: Uint8Array, withWaveform = false) {\r\n    return this.pushDecodeTask(typedArray, withWaveform).then(async(result) => {\r\n      const dataBlob = new Blob([result.bytes], {type: \"audio/wav\"});\r\n      return {url: await apiManagerProxy.invoke('createObjectURL', dataBlob), waveform: result.waveform};\r\n    });\r\n  }\r\n}\r\n\r\nconst opusDecodeController = new OpusDecodeController();\r\nMOUNT_CLASS_TO.opusDecodeController = opusDecodeController;\r\nexport default opusDecodeController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport emojiRegExp from '../../vendor/emoji/regex';\r\nimport { MessageEntity } from '../../layer';\r\n\r\nconst EmojiHelper = {\r\n  emojiMap: (code: string) => { return code; },\r\n  shortcuts: [] as any,\r\n  emojis: [] as any\r\n};\r\n\r\nexport const ALPHA_CHARS_REG_EXP = 'a-z' +\r\n  '\\\\u00c0-\\\\u00d6\\\\u00d8-\\\\u00f6\\\\u00f8-\\\\u00ff' + // Latin-1\r\n  '\\\\u0100-\\\\u024f' + // Latin Extended A and B\r\n  '\\\\u0253\\\\u0254\\\\u0256\\\\u0257\\\\u0259\\\\u025b\\\\u0263\\\\u0268\\\\u026f\\\\u0272\\\\u0289\\\\u028b' + // IPA Extensions\r\n  '\\\\u02bb' + // Hawaiian\r\n  '\\\\u0300-\\\\u036f' + // Combining diacritics\r\n  '\\\\u1e00-\\\\u1eff' + // Latin Extended Additional (mostly for Vietnamese)\r\n  '\\\\u0400-\\\\u04ff\\\\u0500-\\\\u0527' + // Cyrillic\r\n  '\\\\u2de0-\\\\u2dff\\\\ua640-\\\\ua69f' + // Cyrillic Extended A/B\r\n  '\\\\u0591-\\\\u05bf\\\\u05c1-\\\\u05c2\\\\u05c4-\\\\u05c5\\\\u05c7' +\r\n  '\\\\u05d0-\\\\u05ea\\\\u05f0-\\\\u05f4' + // Hebrew\r\n  '\\\\ufb1d-\\\\ufb28\\\\ufb2a-\\\\ufb36\\\\ufb38-\\\\ufb3c\\\\ufb3e\\\\ufb40-\\\\ufb41' +\r\n  '\\\\ufb43-\\\\ufb44\\\\ufb46-\\\\ufb4f' + // Hebrew Pres. Forms\r\n  '\\\\u0610-\\\\u061a\\\\u0620-\\\\u065f\\\\u066e-\\\\u06d3\\\\u06d5-\\\\u06dc' +\r\n  '\\\\u06de-\\\\u06e8\\\\u06ea-\\\\u06ef\\\\u06fa-\\\\u06fc\\\\u06ff' + // Arabic\r\n  '\\\\u0750-\\\\u077f\\\\u08a0\\\\u08a2-\\\\u08ac\\\\u08e4-\\\\u08fe' + // Arabic Supplement and Extended A\r\n  '\\\\ufb50-\\\\ufbb1\\\\ufbd3-\\\\ufd3d\\\\ufd50-\\\\ufd8f\\\\ufd92-\\\\ufdc7\\\\ufdf0-\\\\ufdfb' + // Pres. Forms A\r\n  '\\\\ufe70-\\\\ufe74\\\\ufe76-\\\\ufefc' + // Pres. Forms B\r\n  '\\\\u200c' + // Zero-Width Non-Joiner\r\n  '\\\\u0e01-\\\\u0e3a\\\\u0e40-\\\\u0e4e' + // Thai\r\n  '\\\\u1100-\\\\u11ff\\\\u3130-\\\\u3185\\\\uA960-\\\\uA97F\\\\uAC00-\\\\uD7AF\\\\uD7B0-\\\\uD7FF' + // Hangul (Korean)\r\n  '\\\\u3003\\\\u3005\\\\u303b' + // Kanji/Han iteration marks\r\n  '\\\\uff21-\\\\uff3a\\\\uff41-\\\\uff5a' + // full width Alphabet\r\n  '\\\\uff66-\\\\uff9f' + // half width Katakana\r\n  '\\\\uffa1-\\\\uffdc'; // half width Hangul (Korean)\r\nexport const ALPHA_NUMERIC_REG_EXP = '0-9\\_' + ALPHA_CHARS_REG_EXP;\r\nexport const DOMAIN_ADD_CHARS = '\\u00b7';\r\n// Based on Regular Expression for URL validation by Diego Perini\r\nexport const URL_ALPHANUMERIC_REG_EXP_PART = '[' + ALPHA_CHARS_REG_EXP + '0-9]';\r\nexport const URL_PROTOCOL_REG_EXP_PART = '((?:https?|ftp)://|mailto:)?';\r\nexport const URL_REG_EXP = URL_PROTOCOL_REG_EXP_PART +\r\n  // user:pass authentication\r\n  '(?:' + URL_ALPHANUMERIC_REG_EXP_PART + '{1,64}(?::' + URL_ALPHANUMERIC_REG_EXP_PART + '{0,64})?@)?' +\r\n  '(?:' +\r\n  // sindresorhus/ip-regexp\r\n  '(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}' +\r\n  '|' +\r\n  // host name\r\n  URL_ALPHANUMERIC_REG_EXP_PART + '[' + ALPHA_CHARS_REG_EXP + DOMAIN_ADD_CHARS + '0-9\\-]{0,64}' +\r\n  // domain name\r\n  '(?:\\\\.' + URL_ALPHANUMERIC_REG_EXP_PART + '[' + ALPHA_CHARS_REG_EXP + DOMAIN_ADD_CHARS + '0-9\\-]{0,64}){0,10}' +\r\n  // TLD identifier\r\n  '(?:\\\\.(xn--[0-9a-z]{2,16}|[' + ALPHA_CHARS_REG_EXP + ']{2,24}))' +\r\n  ')' +\r\n  // port number\r\n  '(?::\\\\d{2,5})?' +\r\n  // resource path\r\n  '(?:/(?:\\\\S{0,255}[^\\\\s.;,(\\\\[\\\\]{}<>\"\\'])?)?';\r\nexport const URL_PROTOCOL_REG_EXP = new RegExp('^' + URL_PROTOCOL_REG_EXP_PART.slice(0, -1), 'i');\r\nexport const URL_ANY_PROTOCOL_REG_EXP = /^((?:[^\\/]+?):\\/\\/|mailto:)/;\r\nexport const USERNAME_REG_EXP = '[a-zA-Z\\\\d_]{5,32}';\r\nexport const BOT_COMMAND_REG_EXP = '\\\\/([a-zA-Z\\\\d_]{1,32})(?:@(' + USERNAME_REG_EXP + '))?(\\\\b|$)';\r\nexport const FULL_REG_EXP = new RegExp('(^| )(@)(' + USERNAME_REG_EXP + ')|(' + URL_REG_EXP + ')|(\\\\n)|(' + emojiRegExp + ')|(^|[\\\\s\\\\(\\\\]])(#[' + ALPHA_NUMERIC_REG_EXP + ']{2,64})|(^|\\\\s)' + BOT_COMMAND_REG_EXP, 'i');\r\nexport const EMAIL_REG_EXP = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n//const markdownTestRegExp = /[`_*@~]/;\r\nexport const MARKDOWN_REG_EXP = /(^|\\s|\\n)(````?)([\\s\\S]+?)(````?)([\\s\\n\\.,:?!;]|$)|(^|\\s|\\x01)(`|~~|\\*\\*|__|_-_|\\|\\|)([^\\n]+?)\\7([\\x01\\s\\.,:?!;]|$)|@(\\d+)\\s*\\((.+?)\\)|(\\[(.+?)\\]\\((.+?)\\))/m;\r\nexport const SITE_HASHTAGS: {[siteName: string]: string} = {\r\n  Telegram: 'tg://search_hashtag?hashtag={1}',\r\n  Twitter: 'https://twitter.com/hashtag/{1}',\r\n  Instagram: 'https://instagram.com/explore/tags/{1}/',\r\n  'Google Plus': 'https://plus.google.com/explore/{1}'\r\n};\r\n\r\n// export const SITE_MENTIONS: {[siteName in 'Telegram' | 'Twitter' | 'Instagram' | 'GitHub']: string} = {\r\n//   Telegram: '#{1}',\r\n//   Twitter: 'https://twitter.com/{1}',\r\n//   Instagram: 'https://instagram.com/{1}/',\r\n//   GitHub: 'https://github.com/{1}'\r\n// };\r\n\r\nexport const MARKDOWN_ENTITIES: {[markdown: string]: MessageEntity['_']} = {\r\n  '`': 'messageEntityCode',\r\n  '``': 'messageEntityPre',\r\n  '**': 'messageEntityBold',\r\n  '__': 'messageEntityItalic',\r\n  '~~': 'messageEntityStrike',\r\n  '_-_': 'messageEntityUnderline',\r\n  '||': 'messageEntitySpoiler'\r\n};\r\n\r\nexport const PASS_CONFLICTING_ENTITIES: Set<MessageEntity['_']> = new Set([\r\n  'messageEntityEmoji',\r\n  'messageEntityLinebreak',\r\n  'messageEntityCaret'\r\n]);\r\nfor(let i in MARKDOWN_ENTITIES) {\r\n  PASS_CONFLICTING_ENTITIES.add(MARKDOWN_ENTITIES[i]);\r\n}\r\n\r\nexport const PHONE_NUMBER_REG_EXP = /^\\+\\d+$/;\r\n\r\n/* export function parseEmojis(text: string) {\r\n  return text.replace(/:([a-z0-9\\-\\+\\*_]+?):/gi, function (all, shortcut) {\r\n    var emojiCode = EmojiHelper.shortcuts[shortcut]\r\n    if (emojiCode !== undefined) {\r\n      return EmojiHelper.emojis[emojiCode][0]\r\n    }\r\n    return all\r\n  })\r\n} */\r\n\r\n\r\n\r\n/* export function replaceUrlEncodings(urlWithEncoded: string) {\r\n  return urlWithEncoded.replace(/(%[A-Z\\d]{2})+/g, (str) => {\r\n    try {\r\n      return decodeURIComponent(str);\r\n    } catch (e) {\r\n      return str;\r\n    }\r\n  });\r\n} */\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type { Message, StickerSet, Update, NotifyPeer, PeerNotifySettings, PollResults, Poll, WebPage, GroupCall, GroupCallParticipant, ReactionCount, MessagePeerReaction, PhoneCall } from \"../layer\";\r\nimport type { AppMessagesManager, Dialog, MessagesStorageKey, MyMessage } from \"./appManagers/appMessagesManager\";\r\nimport type { MyDialogFilter } from \"./storages/filters\";\r\nimport type { Folder } from \"./storages/dialogs\";\r\nimport type { UserTyping } from \"./appManagers/appProfileManager\";\r\nimport type { MyDraftMessage } from \"./appManagers/appDraftsManager\";\r\nimport type { ConnectionStatusChange } from \"./mtproto/connectionStatus\";\r\nimport type { GroupCallId } from \"./appManagers/appGroupCallsManager\";\r\nimport type { AppManagers } from \"./appManagers/managers\";\r\nimport type { State } from \"../config/state\";\r\nimport type { Progress } from \"./appManagers/appDownloadManager\";\r\nimport type { CallId } from \"./appManagers/appCallsManager\";\r\nimport type { MyDocument } from \"./appManagers/appDocsManager\";\r\nimport { NULL_PEER_ID, UserAuth } from \"./mtproto/mtproto_config\";\r\nimport EventListenerBase from \"../helpers/eventListenerBase\";\r\nimport { MOUNT_CLASS_TO } from \"../config/debug\";\r\nimport MTProtoMessagePort from \"./mtproto/mtprotoMessagePort\";\r\nimport { IS_WORKER } from \"../helpers/context\";\r\n\r\nexport type BroadcastEvents = {\r\n  'chat_full_update': ChatId,\r\n  'chat_update': ChatId,\r\n\r\n  'channel_update': ChatId,\r\n  \r\n  'user_update': UserId,\r\n  'user_auth': UserAuth,\r\n  'user_full_update': UserId,\r\n\r\n  'peer_pinned_messages': {peerId: PeerId, mids?: number[], pinned?: boolean, unpinAll?: true},\r\n  'peer_pinned_hidden': {peerId: PeerId, maxId: number},\r\n  'peer_typings': {peerId: PeerId, typings: UserTyping[]},\r\n  'peer_block': {peerId: PeerId, blocked: boolean},\r\n  'peer_title_edit': PeerId,\r\n  'peer_bio_edit': PeerId,\r\n  'peer_deleted': PeerId, // left chat, deleted user dialog, left channel\r\n  'peer_full_update': PeerId,\r\n\r\n  'filter_delete': MyDialogFilter,\r\n  'filter_update': MyDialogFilter,\r\n  'filter_new': MyDialogFilter,\r\n  'filter_order': number[],\r\n\r\n  'folder_unread': Omit<Folder, 'dialogs' | 'dispatchUnreadTimeout'>,\r\n  \r\n  'dialog_draft': {peerId: PeerId, dialog: Dialog, drop: boolean, draft: MyDraftMessage | undefined},\r\n  'dialog_unread': {peerId: PeerId, dialog: Dialog},\r\n  'dialog_flush': {peerId: PeerId, dialog: Dialog},\r\n  'dialog_drop': {peerId: PeerId, dialog?: Dialog},\r\n  'dialog_migrate': {migrateFrom: PeerId, migrateTo: PeerId},\r\n  //'dialog_top': Dialog,\r\n  'dialog_notify_settings': Dialog,\r\n  // 'dialog_order': {dialog: Dialog, pos: number},\r\n  'dialogs_multiupdate': {[peerId: PeerId]: Dialog},\r\n  \r\n  'history_append': {storageKey: MessagesStorageKey, message: Message.message},\r\n  'history_update': {storageKey: MessagesStorageKey, message: MyMessage, sequential?: boolean},\r\n  'history_reply_markup': {peerId: PeerId},\r\n  'history_multiappend': MyMessage,\r\n  'history_delete': {peerId: PeerId, msgs: Set<number>},\r\n  'history_forbidden': PeerId,\r\n  'history_reload': PeerId,\r\n  //'history_request': void,\r\n  \r\n  'message_edit': {storageKey: MessagesStorageKey, peerId: PeerId, mid: number, message: MyMessage},\r\n  'message_sent': {storageKey: MessagesStorageKey, tempId: number, tempMessage: any, mid: number, message: MyMessage},\r\n  'messages_views': {peerId: PeerId, mid: number, views: number}[],\r\n  'messages_reactions': {message: Message.message, changedResults: ReactionCount[]}[],\r\n  'messages_pending': void,\r\n  'messages_read': void,\r\n  'messages_downloaded': {peerId: PeerId, mids: number[]},\r\n  'messages_media_read': {peerId: PeerId, mids: number[]},\r\n\r\n  'replies_updated': Message.message,\r\n\r\n  'scheduled_new': Message.message,\r\n  'scheduled_delete': {peerId: PeerId, mids: number[]},\r\n\r\n  'album_edit': {peerId: PeerId, groupId: string, deletedMids: number[], messages: Message.message[]},\r\n\r\n  'stickers_installed': StickerSet.stickerSet,\r\n  'stickers_deleted': StickerSet.stickerSet,\r\n  'stickers_recent': MyDocument[],\r\n\r\n  'state_cleared': void,\r\n  'state_synchronized': ChatId | void,\r\n  'state_synchronizing': ChatId | void,\r\n  \r\n  'contacts_update': UserId,\r\n  'avatar_update': PeerId,\r\n  'poll_update': {poll: Poll, results: PollResults},\r\n  'invalidate_participants': ChatId,\r\n  //'channel_settings': {channelId: number},\r\n  'webpage_updated': {id: WebPage.webPage['id'], msgs: {peerId: PeerId, mid: number, isScheduled: boolean}[]},\r\n\r\n  'connection_status_change': ConnectionStatusChange,\r\n  'settings_updated': {key: string, value: any, settings: State['settings']},\r\n  'draft_updated': {peerId: PeerId, threadId: number, draft: MyDraftMessage | undefined, force?: boolean},\r\n  \r\n  'background_change': void,\r\n  \r\n  'privacy_update': Update.updatePrivacy,\r\n  \r\n  'notify_settings': Update.updateNotifySettings,\r\n  'notify_peer_type_settings': {key: Exclude<NotifyPeer['_'], 'notifyPeer'>, settings: PeerNotifySettings},\r\n\r\n  'notification_reset': string,\r\n  'notification_cancel': string,\r\n  \r\n  'language_change': string,\r\n  \r\n  'theme_change': void,\r\n\r\n  'media_play': void,\r\n  \r\n  'emoji_recent': string,\r\n  \r\n  'download_progress': Progress,\r\n  'document_downloading': DocId,\r\n  'document_downloaded': DocId,\r\n\r\n  'choosing_sticker': boolean\r\n\r\n  'group_call_update': GroupCall,\r\n  'group_call_participant': {groupCallId: GroupCallId, participant: GroupCallParticipant},\r\n  // 'group_call_video_track_added': {instance: GroupCallInstance}\r\n\r\n  'call_update': PhoneCall,\r\n  'call_signaling': {callId: CallId, data: Uint8Array},\r\n\r\n  'quick_reaction': string,\r\n\r\n  'service_notification': Update.updateServiceNotification,\r\n\r\n  'logging_out': void,\r\n\r\n  'payment_sent': {peerId: PeerId, mid: number, receiptMessage: Message.messageService}\r\n};\r\n\r\nexport type BroadcastEventsListeners = {\r\n  [name in keyof BroadcastEvents]: (e: BroadcastEvents[name]) => void\r\n};\r\n\r\nexport class RootScope extends EventListenerBase<BroadcastEventsListeners> {\r\n  public myId: PeerId = NULL_PEER_ID;\r\n  private connectionStatus: {[name: string]: ConnectionStatusChange} = {};\r\n  public settings: State['settings'];\r\n  public managers: AppManagers;\r\n  public premium: boolean;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.premium = false;\r\n\r\n    this.addEventListener('user_auth', ({id}) => {\r\n      this.myId = id.toPeerId();\r\n    });\r\n\r\n    this.addEventListener('connection_status_change', (status) => {\r\n      this.connectionStatus[status.name] = status;\r\n    });\r\n\r\n    this.dispatchEvent = (e, ...args) => {\r\n      super.dispatchEvent(e, ...args);\r\n      MTProtoMessagePort.getInstance().invokeVoid('event', {name: e as string, args});\r\n    };\r\n\r\n    if(!IS_WORKER) {\r\n      this.addEventListener('settings_updated', ({settings}) => {\r\n        this.settings = settings;\r\n      });\r\n    }\r\n  }\r\n\r\n  public getConnectionStatus() {\r\n    return this.connectionStatus;\r\n  }\r\n  \r\n  public dispatchEventSingle(...args: any[]) {\r\n    // @ts-ignore\r\n    super.dispatchEvent(...args);\r\n  }\r\n}\r\n\r\nconst rootScope = new RootScope();\r\nMOUNT_CLASS_TO.rootScope = rootScope;\r\nexport default rootScope;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { MOUNT_CLASS_TO } from '../../config/debug';\r\nimport deferredPromise, { CancellablePromise } from '../../helpers/cancellablePromise';\r\nimport { WorkerTaskVoidTemplate } from '../../types';\r\n\r\nexport interface ConvertWebPTask extends WorkerTaskVoidTemplate {\r\n  type: 'convertWebp', \r\n  payload: {\r\n    fileName: string, \r\n    bytes: Uint8Array\r\n  }\r\n};\r\n\r\nexport class WebpWorkerController {\r\n  private worker: Worker;\r\n  private convertPromises: {[fileName: string]: CancellablePromise<Uint8Array>} = {};\r\n  \r\n  private init() {\r\n    this.worker = new Worker(new URL('./webp.worker.ts', import.meta.url));\r\n    this.worker.addEventListener('message', (e) => {\r\n      const task = e.data as ConvertWebPTask;\r\n      const payload = task.payload;\r\n\r\n      const promise = this.convertPromises[payload.fileName];\r\n      if(promise) {\r\n        payload.bytes ? promise.resolve(payload.bytes) : promise.reject();\r\n        delete this.convertPromises[payload.fileName];\r\n      }\r\n    });\r\n  }\r\n\r\n  private postMessage(data: ConvertWebPTask) {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    this.worker.postMessage(data);\r\n  }\r\n\r\n  public convert(fileName: string, bytes: Uint8Array) {\r\n    if(this.convertPromises.hasOwnProperty(fileName)) {\r\n      return this.convertPromises[fileName];\r\n    }\r\n    \r\n    const convertPromise = deferredPromise<Uint8Array>();\r\n\r\n    this.postMessage({type: 'convertWebp', payload: {fileName, bytes}});\r\n\r\n    return this.convertPromises[fileName] = convertPromise;\r\n  }\r\n}\r\n\r\nconst webpWorkerController = new WebpWorkerController();\r\nMOUNT_CLASS_TO.webpWorkerController = webpWorkerController;\r\nexport default webpWorkerController;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"589\":\"crypto.worker\",\"630\":\"npm.qr-code-styling\",\"670\":\"sw\",\"678\":\"mtproto.worker\"}[chunkId] || chunkId) + \".\" + {\"8\":\"ba94b8acdde676aa239d\",\"25\":\"a1018e689ac657eaaad5\",\"27\":\"6e958af720919e791f1a\",\"53\":\"9c5014f53fcbb95db85b\",\"61\":\"23727aa9ca5c0e345614\",\"77\":\"8f86b429be05d9c96541\",\"104\":\"c9147a9ad31230400f75\",\"106\":\"c1474265f6a7b1e3f8f9\",\"126\":\"c3f72531807aba222900\",\"301\":\"8330aeddc0c3f0e58199\",\"339\":\"8565d5943beb20283374\",\"392\":\"533cf3672bab78a91acf\",\"436\":\"d97abca9d2e12d017d2f\",\"437\":\"f241eff482c4060ad092\",\"442\":\"a8dda1c5bb8398a8fdaf\",\"458\":\"7809e21787c48f110648\",\"589\":\"9759fd447dd6b954563d\",\"591\":\"bd74c3113892f83e893f\",\"630\":\"a5da1314154586042581\",\"641\":\"acd94527de9bee12a950\",\"642\":\"5b6eea6e1102d00ee8d2\",\"665\":\"f51dc97a710074667379\",\"670\":\"980a7c675f04d81b18e5\",\"678\":\"a6632589462d303470c6\",\"709\":\"b2a551f8bcccaf44e7be\",\"725\":\"58a99a7e67612c6b6659\",\"765\":\"da48f06de65144e230ef\",\"774\":\"aa3a229d9031ca331770\",\"781\":\"ab1f24a4f6667e5e2720\",\"810\":\"958dc006c09312dc4c32\"}[chunkId] + \".chunk.js\";\n};","// This function allow to reference async chunks\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = this[\"webpackChunktweb\"] = this[\"webpackChunktweb\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [960,740], () => (__webpack_require__(6873)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","leafPrototypes","getProto","inProgress","dataWebpackPrefix","oldGetScript","oldLoadScript","queryMap","countMap","STATE_VERSION","BUILD","STATE_INIT","allDialogsLoaded","pinnedOrders","contactsListCachedTime","updates","filters","maxSeenMsgId","stateCreatedTime","Date","now","recentEmoji","topPeersCache","recentSearch","version","build","authState","_","IS_MOBILE","hiddenPinnedMessages","settings","messagesTextSize","distanceUnit","sendShortcut","animationsEnabled","autoDownload","photo","contacts","private","groups","channels","video","file","autoDownloadNew","file_size_max","pFlags","video_preload_large","audio_preload_next","photo_size_max","video_size_max","video_upload_maxbitrate","autoPlay","gifs","videos","stickers","suggest","loop","emoji","big","themes","name","background","blur","slug","color","highlightningColor","intensity","id","theme","notifications","sound","timeFormat","toLocaleString","match","playbackParams","volume","muted","playbackRate","playbackRates","voice","audio","round","keepSigned","chatContextMenuHintWasShown","stateId","notifySettings","IS_APPLE_MX","ctx","document","createElement","getContext","extension","getExtension","renderer","getParameter","UNMASKED_RENDERER_WEBGL","getSupportedExtensions","indexOf","err","CAN_USE_TRANSFERABLES","IS_SAFARI","navigator","userAgent","search","geolocation","getCurrentPosition","IMAGE_MIME_TYPES_SUPPORTED","Set","add","arr","concat","canPlayType","IS_APPLE_MOBILE","replace","IS_FIREFOX","mediaDevices","window","DocumentTouch","USER_AGENT","IS_APPLE","IS_ANDROID","toLowerCase","IS_CHROMIUM","test","vendor","platform","maxTouchPoints","IS_MOBILE_SAFARI","vibrate","VIDEO_MIME_TYPES_SUPPORTED","toDataURL","startsWith","rgbaToHsla","r","g","b","a","max","Math","min","h","s","l","d","hslaToRgba","hue2rgb","p","q","t","hexaToRgba","hexa","offset","length","slice","i","push","parseInt","hexToRgb","hex","hexaToHsla","rgba","rgbaToHexa","map","v","toString","join","hslaStringToHex","hsla","splitted","split","alpha","pop","val","endsWith","hslaStringToRgba","hslaStringToHexa","compareVersion","v1","v2","s1","s2","blurActiveElement","activeElement","cancelEvent","event","originalEvent","stopPropagation","preventDefault","returnValue","cancelBubble","findUpClassName","el","className","closest","fixSafariStickyInput","input","style","transform","focus","then","IS_STICKY_INPUT_BUGGED","key","startY","o","capture","passive","onTouchMove","e","touch","touches","scrollable","target","y","scrolled","scrollTop","scrollHeight","clientHeight","nextScrollTop","lastFocusOutTimeStamp","addEventListener","classList","contains","timeStamp","touchStart","removeEventListener","fixSafariStickyInputFocusing","texts","cache","fonts","text","icons","monospace","loadFonts","types","undefined","Promise","resolve","promises","type","_texts","font","weights","weight","_promises","load","race","all","FOCUS_EVENT_NAME","IdleController","constructor","super","this","_isIdle","focusPromise","focusResolve","isIdle","once","idle","getFocusPromise","value","dispatchEvent","OverlayCounter","overlaysActive","isOverlayActive","fastRafCallbacks","fastRaf","callback","requestAnimationFrame","currentCallbacks","forEach","cb","fastRafConventionalCallbacks","rafPromise","processing","fastRafConventional","fastRafPromise","doubleRaf","themeController","setTheme","themeColorElem","_themeColorElem","head","querySelector","setThemeColor","themeColor","isNight","setAttribute","setThemeListener","darkModeMediaQuery","matchMedia","checkDarkMode","systemTheme","matches","addListener","applyHighlightningColor","getTheme","documentElement","setProperty","removeProperty","colorScheme","toggle","workerHandler","construct","args","location","Worker","SharedWorker","w","Proxy","setWorkerProxy","Element","prototype","toggleAttribute","force","hasAttribute","removeAttribute","rootScope","getProxiedManagers","getElementById","href","singleInstance","visualViewport","lastVH","setViewportVH","setVH","vh","overlayCounter","height","innerHeight","toggleResizeMode","tabId","onImTabChange","wasTabId","tagName","appMediaViewer","perf","performance","langPromise","stateResult","langPack","fadeInWhenFontsReady","elem","promise","opacity","state","appVersion","lang_code","console","log","pagePromise","placeholder","prepend","append","cloneNode","meModule","pushModule","default","setAuthorized","forceUnsubscribe","mount","sentCode","authCode","pause","ready","reload","close","proxied","createProxyProxy","ack","get","receiver","method","createProxy","acknowledged","IDB","db","storageIsAvailable","openDatabase","INSTANCES","isAvailable","createNew","openDbPromise","createIndexes","os","store","indexNames","Array","from","indexName","deleteIndex","indexes","index","createIndex","keyPath","objectParameters","request","indexedDB","open","reject","error","message","finished","setTimeout","onerror","onsuccess","result","calledNew","onclose","onabort","transaction","onversionchange","onupgradeneeded","warn","oldVersion","newVersion","stores","objectStoreNames","objectStore","createObjectStore","static","find","instance","preserve","storage","IDBStorage","storeName","idb","create","delete","entryName","isArray","getObjectStore","clear","save","idx","put","mode","onError","clearTimeout","timeout","onComplete","results","requests","waitForTransactionComplete","oncomplete","callbackResult","left","onRequestFinished","getAll","UNSUPPORTED_LANG_PACK_KEY","I18n","pluralRules","cacheLangPackPromise","setLangCode","langCode","lastRequestedLangCode","lastRequestedNormalizedLangCode","updateAmPm","dateTimeFormat","getDateTimeFormat","hour","minute","hour12","date","setHours","amText","format","amPmCache","am","pmText","pm","loadLocalLangPack","defaultCode","lang","langSign","countries","strings","formatLocalStrings","saveLangPack","from_version","local","loadLangPack","web","requestedServerLanguage","managers","apiManager","invokeApiCacheable","lang_pack","hash","polyfillPromise","pushTo","applyLangPack","currentLangCode","Intl","PluralRules","string","set","countriesList","country","langPackKey","default_name","lastAppliedLangCode","cachedDateTimeFormats","querySelectorAll","element","weakMap","update","superFormatter","indexHolder","out","lastIndex","p1","p2","p3","p4","lastIndexOf","url","wrappedUrl","onclick","textContent","arg","pushNextArgument","plain","str","select","item","Node","Map","getCacheLangPack","finally","setTimeFormat","haveToUpdate","IntlDateElement","getStrings","keys","getLangPack","langPack1","langPack2","localLangPack1","localLangPack2","filter","Boolean","_Intl","Object","assign","WeakMap","IntlElementBase","options","property","IntlElement","formatted","dataset","compareAndUpdate","json","JSON","stringify","DateTimeFormat","hours","getHours","getMinutes","i18n","i18n_","_i18n","joinElementsWith","elements","joiner","isLast","useLast","joined","NULL_PEER_ID","REPLIES_PEER_ID","REPLIES_HIDDEN_CHANNEL_ID","SERVICE_PEER_ID","MUTE_UNTIL","BOT_START_PARAM","IS_CALL_SUPPORTED","IS_CANVAS_FILTER_SUPPORTED","IS_EMOJI_SUPPORTED","IS_GEOLOCATION_SUPPORTED","IS_GROUP_CALL_SUPPORTED","IS_MOV_SUPPORTED","IS_PARALLAX_SUPPORTED","IS_SCREEN_SHARING_SUPPORTED","IS_TOUCH_SUPPORTED","IS_VIBRATE_SUPPORTED","IS_OPUS_SUPPORTED","IS_SHARED_WORKER_SUPPORTED","IS_WEBM_SUPPORTED","IS_WEBP_SUPPORTED","IS_WEBRTC_SUPPORTED","MEDIA_MIME_TYPES_SUPPORTED","ALL_KEYS","REFRESH_KEYS","loadStateInner","logger","totalPerf","recordPromise","stateStorage","sessionStorage","pushedKeys","pushToState","copy","splice","auth","shift","sessionBuild","shiftedWebKAuth","values","dcID","toPeerId","obj","resetStorages","chats","dialogs","users","_state","state_id","time","hasOwnProperty","nightTheme","autoDownloadSettings","oldTypes","mediaType","peerTypeSettings","peerType","validateInitObject","missingKey","migrated","newTheme","k_build","ApiManagerProxy","onMirrorTask","payload","mirrors","mirror","isSWRegistered","taskListenersSW","tabState","chatPeerIds","idleStartTime","registerWorker","registerServiceWorker","registerCryptoWorker","addMultipleEventsListeners","convertWebp","fileName","bytes","webpWorkerController","convertOpus","opusDecodeController","localStorageProxy","storageTask","language","toggleStorages","telegramMeWebManager","webPushApiManager","cacheName","caches","appRuntimeManager","idleController","updateTabStateIdle","invoke","worker","serviceWorker","register","URL","scope","registration","installing","waiting","active","invokeVoid","controller","task","data","isObject","addServiceWorkerTaskListener","responseTask","docId","dcId","limit","uploadFile","postSWMessage","originalPayload","cryptoMessagePort","source","ports","attachWorkerToPort","onWorkerFirstMessage","messagePort","port","attachPort","postMessage","loadState","sendState","userId","invokeCrypto","enabled","clearWrite","getMirror","getState","updateTabState","apiManagerProxy","IS_MULTIPLE_TABS_SUPPORTED","SingleInstance","clearInstance","masterInstance","deactivated","checkInstance","newInstance","instanceId","curInstance","deactivateInstance","xt_instance","clearDeactivateTimeout","deactivateTimeout","deactivatedReason","start","reset","started","setInterval","activateInstance","reason","TelegramMeWebManager","disabled","hostname","canRedirect","curValue","ts","tgme_sync","path","encodeURIComponent","script","remove","WebPushApiManager","isPushEnabled","localNotificationsAvailable","isFirefox","userVisibleOnly","subscribe","reg","pushManager","subscription","pushSubscriptionNotify","catch","Notification","permission","isAliveNotify","baseUrl","ACTIONS_LANG_MAP","push_action_mute1d","push_action_settings","push_message_nopreview","action","localNotifications","isAliveTO","getSubscription","setUpServiceWorkerChannel","setLocalNotificationsDisabled","unsubscribe","successful","setSettings","newSettings","hidePushNotifications","subscriptionObj","toJSON","endpoint","p256dh","tokenType","tokenValue","sampleRate","tasks","keepAlive","isPlaySupported","loadWavWorker","wavWorker","page","onTaskEnd","loadWorker","command","waveform","buffers","typedArray","buffer","setKeepAlive","terminateWorkers","executeNewTask","kill","terminate","decoderSampleRate","outputBufferSampleRate","wavBitDepth","wavSampleRate","pages","withWaveform","pushDecodeTask","decode","dataBlob","Blob","ALPHA_CHARS_REG_EXP","URL_ALPHANUMERIC_REG_EXP_PART","URL_PROTOCOL_REG_EXP_PART","URL_REG_EXP","URL_ANY_PROTOCOL_REG_EXP","RegExp","FULL_REG_EXP","EMAIL_REG_EXP","MARKDOWN_REG_EXP","SITE_HASHTAGS","Telegram","Twitter","Instagram","MARKDOWN_ENTITIES","PASS_CONFLICTING_ENTITIES","PHONE_NUMBER_REG_EXP","RootScope","myId","connectionStatus","premium","status","getConnectionStatus","dispatchEventSingle","convertPromises","init","convert","convertPromise","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","call","m","O","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","every","n","getter","__esModule","getPrototypeOf","ns","def","current","getOwnPropertyNames","definition","defineProperty","enumerable","f","chunkId","reduce","u","miniCssF","globalThis","Function","prop","done","needAttach","scripts","getElementsByTagName","getAttribute","charset","nc","src","onScriptComplete","prev","onload","doneFns","parentNode","removeChild","bind","appendChild","Symbol","toStringTag","scriptUrl","importScripts","currentScript","Error","retries","realSrc","cacheBust","baseURI","self","installedChunks","installedChunkData","errorType","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}